<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetWorld - 计算机网络基础</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Segoe UI', 'PingFang SC', system-ui, sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        
        /* 顶部导航激活样式 */
        .nav-item.active { color: #60a5fa; border-bottom: 2px solid #60a5fa; }
        .nav-item { transition: all 0.2s ease; border-bottom: 2px solid transparent; }
        .nav-item:hover:not(.active) { color: #93c5fd; }

        /* 隐藏滚动条但保留功能 */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes flowRight { 0% { left: 0; opacity: 1; } 100% { left: 100%; opacity: 0; } }
        @keyframes flowLeft { 0% { left: 100%; opacity: 1; } 100% { left: 0; opacity: 0; } }
        
        .animate-flow-right { animation: flowRight 1.5s linear infinite; }
        .animate-flow-left { animation: flowLeft 1.5s linear infinite; }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* 代码块样式 */
        .code-block { font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; line-height: 1.5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS WRAPPER ---
        const Icon = ({ name, size = 18, className }) => {
            const icons = {
                Home: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
                MapPin: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
                Truck: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="13" x="1" y="5" rx="2" /><polygon points="19 18 19 9 17 9 17 5 13 5 13 9 13 18" /><circle cx="5.5" cy="18.5" r="2.5" /><circle cx="13.5" cy="18.5" r="2.5" /></svg>,
                Layers: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
                Network: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="16" y="16" width="6" height="6" rx="1"/><rect x="2" y="16" width="6" height="6" rx="1"/><rect x="9" y="2" width="6" height="6" rx="1"/><path d="M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3"/><path d="M12 12V8"/></svg>,
                Search: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
                Server: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>,
                Globe: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
                Lock: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
                Database: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
                FileText: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>,
                User: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            };
            return icons[name] || null;
        };

        // --- PAGE 1: ADVANCED CS MODEL ---
        const PageIntro = () => {
            const [scenario, setScenario] = useState('static'); // static, login
            const [status, setStatus] = useState('idle'); // idle, sending, processing, db_query, db_return, responding, rendering
            const [logs, setLogs] = useState([]);

            const scenarios = {
                static: {
                    label: "浏览文章 (GET)",
                    icon: "FileText",
                    req: "GET /index.html HTTP/1.1\nHost: www.example.com",
                    res: "HTTP/1.1 200 OK\nContent-Type: text/html\n\n<html>...</html>",
                    hasDB: false
                },
                login: {
                    label: "用户登录 (POST)",
                    icon: "User",
                    req: "POST /api/login HTTP/1.1\nContent-Type: application/json\n\n{\"u\":\"user\", \"p\":\"***\"}",
                    res: "HTTP/1.1 200 OK\nSet-Cookie: session_id=xyz\n\n{\"status\":\"success\"}",
                    hasDB: true
                }
            };

            const runSimulation = () => {
                if(status !== 'idle') return;
                
                setLogs([]);
                const currentScenario = scenarios[scenario];

                // Step 1: Client Sending
                setStatus('sending');
                addLog('Client', '构建请求报文', currentScenario.req);

                // Step 2: Server Processing
                setTimeout(() => {
                    setStatus('processing');
                    addLog('Server', '接收并解析请求', '正在分析请求路径与方法...');
                    
                    // Step 3: DB (Optional)
                    if (currentScenario.hasDB) {
                        setTimeout(() => {
                            setStatus('db_query');
                            addLog('Server', '查询数据库', 'SELECT * FROM users WHERE...');
                            
                            setTimeout(() => {
                                setStatus('db_return');
                                addLog('Database', '返回查询结果', 'User found. ID: 1001');
                                
                                setTimeout(() => {
                                    setStatus('responding');
                                    addLog('Server', '生成响应报文', currentScenario.res);
                                }, 1000);
                            }, 1500);
                        }, 1500);
                    } else {
                        // Static file directly
                        setTimeout(() => {
                            addLog('Server', '读取静态文件', 'Reading /var/www/index.html...');
                            setStatus('responding');
                            addLog('Server', '生成响应报文', currentScenario.res);
                        }, 1500);
                    }

                }, 2000);
            };

            // Watch for responding state to finish simulation
            useEffect(() => {
                if (status === 'responding') {
                    setTimeout(() => {
                        setStatus('rendering');
                        addLog('Client', '接收响应并渲染', '解析 HTML/JSON 并更新界面');
                        setTimeout(() => setStatus('idle'), 2000);
                    }, 2000);
                }
            }, [status]);

            const addLog = (source, action, detail) => {
                setLogs(prev => [...prev, { source, action, detail, time: new Date().toLocaleTimeString() }]);
            };

            const currentScen = scenarios[scenario];

            return (
                <div className="space-y-6 fade-in pb-12">
                    <header className="mb-4 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-blue-400">基础架构：C/S 模型深度解析</h2>
                        <p className="text-slate-400 mt-2 text-base">
                            不只是简单的“请求-响应”。在这里，你可以看到数据包是如何被构建、传输、在服务器内部流转（Web服务 vs 数据库），最终被浏览器渲染的完整生命周期。
                        </p>
                    </header>

                    {/* Scenario Selector */}
                    <div className="flex gap-4 mb-6">
                        {Object.entries(scenarios).map(([key, data]) => (
                            <button
                                key={key}
                                onClick={() => { setScenario(key); setStatus('idle'); setLogs([]); }}
                                disabled={status !== 'idle'}
                                className={`flex items-center gap-2 px-4 py-3 rounded-lg border transition-all ${
                                    scenario === key 
                                    ? 'bg-blue-600/20 border-blue-500 text-blue-300' 
                                    : 'bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600'
                                } ${status !== 'idle' ? 'opacity-50 cursor-not-allowed' : ''}`}
                            >
                                <Icon name={data.icon} />
                                <div className="text-left">
                                    <div className="font-bold text-sm">{data.label}</div>
                                    <div className="text-[10px] opacity-70">{key === 'static' ? '无需查库' : '涉及数据库交互'}</div>
                                </div>
                            </button>
                        ))}
                    </div>

                    {/* MAIN STAGE */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        {/* Left: Visual Animation */}
                        <div className="lg:col-span-2 glass-panel p-1 rounded-xl bg-slate-900/50 relative overflow-hidden min-h-[400px]">
                            
                            {/* 1. Client Zone */}
                            <div className="absolute top-1/2 left-8 -translate-y-1/2 w-28 flex flex-col items-center z-10">
                                <div className={`w-24 h-20 bg-slate-800 border-2 rounded-lg flex flex-col overflow-hidden transition-all duration-500 ${status === 'rendering' ? 'border-green-400 shadow-[0_0_20px_rgba(74,222,128,0.3)]' : 'border-slate-600'}`}>
                                    {/* Simulated Browser UI */}
                                    <div className="h-4 bg-slate-700 w-full flex items-center px-1 gap-1">
                                        <div className="w-1.5 h-1.5 rounded-full bg-red-500"></div>
                                        <div className="w-1.5 h-1.5 rounded-full bg-yellow-500"></div>
                                        <div className="h-2 bg-slate-900 rounded w-16 ml-1"></div>
                                    </div>
                                    <div className="flex-1 bg-white p-1 relative">
                                        {status === 'idle' && <div className="text-[8px] text-slate-400 text-center mt-4">Ready</div>}
                                        {(status === 'sending' || status === 'processing' || status.includes('db')) && (
                                            <div className="absolute inset-0 flex items-center justify-center">
                                                <div className="w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                                            </div>
                                        )}
                                        {status === 'rendering' && (
                                            <div className="animate-pulse space-y-1">
                                                <div className="h-2 bg-slate-200 rounded w-3/4"></div>
                                                <div className="h-2 bg-slate-200 rounded w-full"></div>
                                                <div className="h-2 bg-slate-200 rounded w-1/2"></div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                <div className="mt-2 text-center">
                                    <div className="font-bold text-sm text-slate-300">Client (Browser)</div>
                                    <button 
                                        onClick={runSimulation} 
                                        disabled={status !== 'idle'}
                                        className={`mt-2 px-3 py-1 rounded text-xs font-bold transition-all ${status === 'idle' ? 'bg-blue-600 text-white hover:bg-blue-500 shadow-lg hover:shadow-blue-500/50' : 'bg-slate-700 text-slate-500'}`}
                                    >
                                        {status === 'idle' ? '发起请求' : '处理中...'}
                                    </button>
                                </div>
                            </div>

                            {/* 2. Server Zone */}
                            <div className="absolute top-1/2 right-8 -translate-y-1/2 w-48 h-64 border border-slate-700 rounded-xl bg-slate-800/30 p-2 flex flex-col justify-between z-10">
                                <div className="absolute -top-3 left-4 bg-slate-800 text-[10px] text-slate-400 px-2">Data Center</div>
                                
                                {/* Web Server App */}
                                <div className={`h-24 bg-slate-800 border-2 rounded-lg flex flex-col items-center justify-center relative transition-all duration-300 ${['processing', 'responding'].includes(status) ? 'border-indigo-400 shadow-[0_0_15px_rgba(129,140,248,0.3)]' : 'border-indigo-900/50'}`}>
                                    <Icon name="Server" className="text-indigo-400 mb-1" />
                                    <div className="text-xs font-bold text-indigo-300">Web Server</div>
                                    <div className="text-[9px] text-slate-500">Nginx / Node.js</div>
                                    {['processing', 'responding'].includes(status) && <div className="absolute top-1 right-1 w-2 h-2 bg-green-400 rounded-full animate-ping"></div>}
                                </div>

                                {/* Internal Connection */}
                                <div className="flex-1 flex justify-center py-1">
                                    <div className={`w-1 transition-colors duration-300 ${['db_query', 'db_return'].includes(status) ? 'bg-yellow-500 animate-pulse' : 'bg-slate-700'}`}></div>
                                </div>

                                {/* Database */}
                                <div className={`h-20 bg-slate-800 border-2 rounded-lg flex flex-col items-center justify-center relative transition-all duration-300 ${['db_query', 'db_return'].includes(status) ? 'border-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.3)]' : 'border-slate-700 opacity-60'}`}>
                                    <Icon name="Database" className={['db_query', 'db_return'].includes(status) ? "text-yellow-400" : "text-slate-600"} />
                                    <div className="text-xs font-bold text-slate-300 mt-1">Database</div>
                                    {['db_query', 'db_return'].includes(status) && <div className="text-[8px] text-yellow-500 absolute bottom-1 animate-pulse">Querying...</div>}
                                </div>
                            </div>

                            {/* 3. The Pipes & Packets */}
                            {/* Request Path */}
                            <div className="absolute top-[35%] left-32 right-52 h-[2px] bg-slate-800">
                                {status === 'sending' && (
                                    <div className="absolute top-1/2 -translate-y-1/2 animate-flow-right z-20">
                                        <div className="bg-blue-600 text-white text-[10px] font-mono px-2 py-1 rounded shadow-lg border border-blue-400 whitespace-nowrap">
                                            {currentScen.req.split('\n')[0]}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Response Path */}
                            <div className="absolute top-[45%] left-32 right-52 h-[2px] bg-slate-800">
                                {status === 'responding' && (
                                    <div className="absolute top-1/2 -translate-y-1/2 animate-flow-left z-20">
                                        <div className="bg-green-600 text-white text-[10px] font-mono px-2 py-1 rounded shadow-lg border border-green-400 whitespace-nowrap">
                                            HTTP 200 OK
                                        </div>
                                    </div>
                                )}
                            </div>

                        </div>

                        {/* Right: Network Log Console */}
                        <div className="glass-panel rounded-xl flex flex-col h-[400px] overflow-hidden border-slate-700">
                            <div className="bg-slate-800 p-3 border-b border-slate-700 flex justify-between items-center">
                                <div className="font-mono text-xs text-slate-300 flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-red-500"></div> Network Inspector
                                </div>
                                <div className="text-[10px] text-slate-500">Live Traffic</div>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-950 font-mono text-xs custom-scroll">
                                {logs.length === 0 && (
                                    <div className="text-slate-600 text-center mt-10 italic">Waiting for request...</div>
                                )}
                                {logs.map((log, i) => (
                                    <div key={i} className="animate-fade-in">
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="text-slate-500">[{log.time}]</span>
                                            <span className={`font-bold px-1.5 py-0.5 rounded text-[10px] ${
                                                log.source === 'Client' ? 'bg-blue-900 text-blue-300' :
                                                log.source === 'Server' ? 'bg-indigo-900 text-indigo-300' :
                                                'bg-yellow-900 text-yellow-300'
                                            }`}>{log.source}</span>
                                            <span className="text-slate-300">{log.action}</span>
                                        </div>
                                        {log.detail && (
                                            <div className="ml-4 pl-2 border-l-2 border-slate-800 text-slate-500 whitespace-pre-wrap break-all bg-slate-900/50 p-2 rounded">
                                                {log.detail}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                    </div>
                    
                    {/* Deep Dive Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                         <div className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 hover:border-blue-500/30 transition-colors">
                            <h4 className="font-bold text-blue-400 mb-2 text-sm">构建 (Build)</h4>
                            <p className="text-xs text-slate-400 leading-relaxed">
                                客户端将你的点击行为转化为符合 HTTP 协议的字符串。包括请求行（Method Path）、请求头（Headers）和请求体（Body）。
                            </p>
                        </div>
                        <div className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 hover:border-indigo-500/30 transition-colors">
                            <h4 className="font-bold text-indigo-400 mb-2 text-sm">处理 (Process)</h4>
                            <p className="text-xs text-slate-400 leading-relaxed">
                                Web 服务器接收请求，如果是静态资源（图片/HTML）直接读取文件；如果是动态请求（登录），则需要执行代码并查询数据库。
                            </p>
                        </div>
                        <div className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 hover:border-green-500/30 transition-colors">
                            <h4 className="font-bold text-green-400 mb-2 text-sm">渲染 (Render)</h4>
                            <p className="text-xs text-slate-400 leading-relaxed">
                                浏览器拿到 HTML 代码并不是结束。它需要解析 DOM 树，加载 CSS 样式，执行 JS 脚本，最终像素级绘制在屏幕上。
                            </p>
                        </div>
                    </div>

                </div>
            );
        };

        // --- PAGE 2: ADDRESSING ---
        const PageAddressing = () => {
             const [step, setStep] = useState(0); 
             const [domain, setDomain] = useState('bilibili.com');
             const [resolveResult, setResolveResult] = useState({ ip: '', type: '' });

             const resolveDns = async () => {
                 if(!domain) return;
                 setStep(1);
                 setResolveResult({ ip: '', type: '' });
                 
                 try {
                     // 1. 并行执行：API请求 + 最小动画延时(1.5秒)，防止动画太快看不清
                     const fetchPromise = fetch(`https://dns.google/resolve?name=${domain}`).then(res => res.json());
                     const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
                     
                     const [data] = await Promise.all([fetchPromise, delayPromise]);

                     if (data.Answer && data.Answer.length > 0) {
                         // 优先找 A 记录 (IPv4)，找不到就拿第一个
                         const record = data.Answer.find(r => r.type === 1) || data.Answer[0];
                         // 如果是 CNAME (type 5)，显示 data，如果是 A (type 1)，显示 IP
                         setResolveResult({ 
                             ip: record.data, 
                             type: record.type === 5 ? 'CNAME' : 'A Record' 
                         });
                     } else {
                         setResolveResult({ ip: '未找到记录', type: 'NXDOMAIN' });
                     }
                 } catch (error) {
                     setResolveResult({ ip: '查询失败 (请检查网络)', type: 'Error' });
                 } finally {
                     setStep(2);
                 }
             };

             return (
                <div className="space-y-8 fade-in pb-12">
                    <header className="mb-6 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-purple-400">网络层与寻址：IP 与 端口</h2>
                        <p className="text-slate-400 mt-2 text-base">网络通信的两个核心要素：定位主机 (IP) 与定位进程 (Port)。</p>
                    </header>

                    {/* DNS Logic Flow */}
                    <div className="glass-panel p-6 rounded-xl">
                        <h3 className="text-base font-bold mb-4 flex items-center gap-2 text-slate-200">
                            <Icon name="Search" /> 
                            DNS 实时解析演示 (Powered by Google DNS)
                        </h3>
                        <div className="flex flex-col md:flex-row items-center gap-4 bg-slate-900/50 p-6 rounded-xl border border-slate-700">
                            
                            {/* Input Area */}
                            <div className={`transition-all duration-500 flex-1`}>
                                <div className="text-xs text-slate-500 mb-1 font-mono">Input Domain</div>
                                <div className="flex gap-2">
                                    <input 
                                        type="text" 
                                        value={domain}
                                        onChange={(e) => setDomain(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && resolveDns()}
                                        className="bg-slate-800 px-3 py-1.5 rounded text-white font-mono border border-slate-600 text-sm outline-none focus:border-purple-500 w-full md:w-48"
                                        placeholder="输入域名..."
                                    />
                                    <button 
                                        onClick={resolveDns} 
                                        disabled={step === 1 || !domain} 
                                        className="bg-purple-600 hover:bg-purple-500 px-4 rounded text-xs disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap transition-colors"
                                    >
                                        {step === 1 ? '查询中...' : '解析 IP'}
                                    </button>
                                </div>
                            </div>

                            <div className="text-slate-600 hidden md:block">&rarr;</div>

                            {/* DNS Server Animation */}
                            <div className={`transition-all duration-500 flex flex-col items-center w-24 ${step >= 1 ? 'opacity-100' : 'opacity-30'}`}>
                                <Icon name="Server" className="text-yellow-500 mb-1" />
                                <div className="text-[10px] text-yellow-500 font-bold uppercase">DNS Server</div>
                                {step === 1 && <div className="text-[10px] text-slate-400 animate-pulse mt-1">Recursive Query...</div>}
                            </div>

                            <div className="text-slate-600 hidden md:block">&rarr;</div>

                            {/* Result Area */}
                            <div className={`transition-all duration-500 flex-1 ${step === 2 ? 'opacity-100' : 'opacity-0'}`}>
                                <div className="text-xs text-slate-500 mb-1 font-mono">Resolved IP</div>
                                <div className="flex flex-col items-start">
                                    <div className={`px-3 py-1.5 rounded font-mono text-sm border shadow-lg ${
                                        resolveResult.type === 'Error' ? 'bg-red-900/30 text-red-400 border-red-900/50' : 
                                        'bg-slate-800 text-green-400 border-green-900/50 shadow-[0_0_15px_rgba(74,222,128,0.1)]'
                                    }`}>
                                        {resolveResult.ip}
                                    </div>
                                    {resolveResult.type && (
                                        <span className="text-[10px] text-slate-500 mt-1 ml-1 bg-slate-900 px-1 rounded border border-slate-800">
                                            Type: {resolveResult.type}
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* IP Section */}
                        <div className="space-y-4">
                            <h3 className="text-lg font-bold text-white border-l-4 border-blue-500 pl-3">IP 地址 (IPv4)</h3>
                            <p className="text-slate-400 text-sm">
                                网络层协议，用于在分组交换网络中唯一标识一台主机。
                            </p>
                            <div className="bg-slate-800 p-4 rounded-lg font-mono text-center text-base tracking-wider border border-slate-600">
                                <span className="text-blue-400">192</span>.<span className="text-blue-400">168</span>.<span className="text-blue-400">1</span>.<span className="text-white font-bold">5</span>
                            </div>
                            <div className="text-xs text-slate-500 mt-2">
                                * IPv4 格式：32位二进制数，通常表示为4个十进制数 (点分十进制)。
                            </div>
                        </div>

                        {/* Port Section */}
                        <div className="space-y-4">
                            <h3 className="text-lg font-bold text-white border-l-4 border-purple-500 pl-3">端口号 (Port Number)</h3>
                            <p className="text-slate-400 text-sm">
                                传输层概念，用于标识主机中特定的应用程序或进程 (多路复用)。
                            </p>
                            
                            <div className="grid grid-cols-2 gap-2 text-sm">
                                <div className="bg-slate-800 p-2 rounded border border-slate-700 flex justify-between">
                                    <span className="font-mono text-purple-300">:80</span>
                                    <span className="text-xs text-slate-400">HTTP (Web)</span>
                                </div>
                                <div className="bg-slate-800 p-2 rounded border border-slate-700 flex justify-between">
                                    <span className="font-mono text-purple-300">:443</span>
                                    <span className="text-xs text-slate-400">HTTPS (Secure)</span>
                                </div>
                                <div className="bg-slate-800 p-2 rounded border border-slate-700 flex justify-between">
                                    <span className="font-mono text-purple-300">:22</span>
                                    <span className="text-xs text-slate-400">SSH (Remote)</span>
                                </div>
                                <div className="bg-slate-800 p-2 rounded border border-slate-700 flex justify-between">
                                    <span className="font-mono text-purple-300">:3306</span>
                                    <span className="text-xs text-slate-400">MySQL (DB)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
             );
        };

// --- PAGE 3: TRANSPORT LAYER (UPGRADED) ---
        const PageTransport = () => {
            const [simMode, setSimMode] = useState('TCP'); // TCP, UDP
            const [packets, setPackets] = useState([]); 
            const [isSimulating, setIsSimulating] = useState(false);
            const [stats, setStats] = useState({ sent: 0, lost: 0, retrans: 0 });

            // 模拟发送数据流
            const runSimulation = async () => {
                if (isSimulating) return;
                setIsSimulating(true);
                setPackets([]);
                setStats({ sent: 0, lost: 0, retrans: 0 });

                const totalPackets = 5;
                let currentId = 1;

                for (let i = 0; i < totalPackets; i++) {
                    // 模拟网络随机丢包 (30% 概率)
                    const willDrop = Math.random() < 0.3;
                    
                    // 添加一个“传输中”的包
                    const pktId = currentId;
                    addPacket(pktId, 'sending', simMode);

                    await wait(600); // 传输延迟

                    if (willDrop) {
                        updatePacket(pktId, 'lost');
                        setStats(prev => ({ ...prev, sent: prev.sent + 1, lost: prev.lost + 1 }));

                        if (simMode === 'TCP') {
                            // TCP 机制：丢包后必须重传，阻塞后续发送
                            await wait(500);
                            updatePacket(pktId, 'retransmitting');
                            await wait(500); // 重传延迟
                            
                            // 假设重传一定成功（简化演示）
                            updatePacket(pktId, 'success');
                            setStats(prev => ({ ...prev, retrans: prev.retrans + 1 }));
                        } else {
                            // UDP 机制：丢了就丢了，不重传
                        }
                    } else {
                        updatePacket(pktId, 'success');
                        setStats(prev => ({ ...prev, sent: prev.sent + 1 }));
                    }
                    
                    currentId++;
                    await wait(300); // 发送间隔
                }
                setIsSimulating(false);
            };

            const addPacket = (id, status, type) => {
                setPackets(prev => [...prev, { id, status, type }]);
            };

            const updatePacket = (id, status) => {
                setPackets(prev => prev.map(p => p.id === id ? { ...p, status } : p));
            };

            const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            return (
                <div className="space-y-12 fade-in pb-12">
                    <header className="mb-6 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-orange-400">传输层：TCP 与 UDP 深度解析</h2>
                        <p className="text-slate-400 mt-2 text-base">
                            应用程序选择哪种协议，决定了数据的可靠性与传输效率。
                        </p>
                    </header>

                    {/* 1. 核心对比卡片 */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* TCP Card */}
                        <div className="bg-slate-800/50 p-6 rounded-xl border border-blue-500/30 hover:bg-slate-800 transition-colors">
                            <div className="flex justify-between items-start mb-4">
                                <h3 className="text-xl font-bold text-blue-400 flex items-center gap-2">
                                    TCP <span className="text-xs bg-blue-900 text-blue-200 px-2 py-0.5 rounded border border-blue-700">可靠</span>
                                </h3>
                            </div>
                            <p className="text-slate-400 text-sm mb-4">
                                "使命必达"。就像挂号信，保证数据不丢、不乱序。如果丢包，它会暂停并重传，直到对方确认收到。
                            </p>
                            <ul className="text-xs text-slate-300 space-y-2 list-disc list-inside bg-slate-900/50 p-3 rounded">
                                <li><strong>网页 (HTTP)</strong>: 丢一个字节都会导致乱码。</li>
                                <li><strong>文件传输</strong>: 不能缺斤少两。</li>
                            </ul>
                        </div>

                        {/* UDP Card */}
                        <div className="bg-slate-800/50 p-6 rounded-xl border border-orange-500/30 hover:bg-slate-800 transition-colors">
                             <div className="flex justify-between items-start mb-4">
                                <h3 className="text-xl font-bold text-orange-400 flex items-center gap-2">
                                    UDP <span className="text-xs bg-orange-900 text-orange-200 px-2 py-0.5 rounded border border-orange-700">极速</span>
                                </h3>
                            </div>
                            <p className="text-slate-400 text-sm mb-4">
                                "发后即忘"。就像寄平信或者广播。它不管你收没收到，只管一直发。速度快，无拥塞控制。
                            </p>
                             <ul className="text-xs text-slate-300 space-y-2 list-disc list-inside bg-slate-900/50 p-3 rounded">
                                <li><strong>视频直播</strong>: 偶尔卡一下比一直转圈强。</li>
                                <li><strong>FPS 游戏</strong>: 只要最新的位置数据，旧的不要了。</li>
                            </ul>
                        </div>
                    </div>

                    {/* 2. 头部开销可视化 (Header Anatomy) */}
                    <div className="glass-panel p-6 rounded-xl">
                        <h3 className="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <Icon name="Layers" size={20} className="text-purple-400"/>
                            协议头部开销对比 (Overhead)
                        </h3>
                        
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-start">
                            {/* TCP Header */}
                            <div>
                                <div className="text-sm text-blue-300 font-bold mb-2 flex justify-between">
                                    <span>TCP 报文头 (20+ 字节)</span>
                                    <span className="text-xs text-slate-500 font-normal">结构复杂，处理慢</span>
                                </div>
                                <div className="border-2 border-slate-700 rounded bg-slate-900 text-[10px] text-slate-400 font-mono text-center">
                                    <div className="grid grid-cols-2 border-b border-slate-700">
                                        <div className="p-2 border-r border-slate-700 bg-slate-800/50">Source Port</div>
                                        <div className="p-2 bg-slate-800/50">Dest Port</div>
                                    </div>
                                    <div className="p-2 border-b border-slate-700 bg-blue-900/20 text-blue-300">Sequence Number (序列号)</div>
                                    <div className="p-2 border-b border-slate-700 bg-green-900/20 text-green-300">Acknowledgment Number (确认号)</div>
                                    <div className="grid grid-cols-4 border-b border-slate-700">
                                        <div className="p-1 border-r border-slate-700 col-span-1">Len</div>
                                        <div className="p-1 border-r border-slate-700 col-span-2 font-bold text-yellow-500">Flags (SYN/ACK/FIN)</div>
                                        <div className="p-1 col-span-1">Window</div>
                                    </div>
                                    <div className="grid grid-cols-2">
                                        <div className="p-2 border-r border-slate-700">Checksum</div>
                                        <div className="p-2">Urgent Pointer</div>
                                    </div>
                                </div>
                                <p className="text-xs text-slate-500 mt-2">
                                    * 包含序列号、确认号用于重传，窗口大小用于流量控制，Flags 用于握手挥手。
                                </p>
                            </div>

                            {/* UDP Header */}
                            <div>
                                <div className="text-sm text-orange-300 font-bold mb-2 flex justify-between">
                                    <span>UDP 报文头 (8 字节)</span>
                                    <span className="text-xs text-slate-500 font-normal">极其轻量，处理快</span>
                                </div>
                                <div className="border-2 border-slate-700 rounded bg-slate-900 text-[10px] text-slate-400 font-mono text-center h-[146px] flex flex-col">
                                    <div className="grid grid-cols-2 border-b border-slate-700 h-1/2">
                                        <div className="flex items-center justify-center border-r border-slate-700 bg-slate-800/50">Source Port</div>
                                        <div className="flex items-center justify-center bg-slate-800/50">Dest Port</div>
                                    </div>
                                    <div className="grid grid-cols-2 h-1/2">
                                        <div className="flex items-center justify-center border-r border-slate-700">Length</div>
                                        <div className="flex items-center justify-center">Checksum</div>
                                    </div>
                                </div>
                                <p className="text-xs text-slate-500 mt-2">
                                    * 只有最基础的端口和校验，几乎没有额外负担。
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* 3. 互动模拟器：丢包处理 */}
                    <div className="glass-panel p-6 rounded-xl border border-slate-700/50">
                        <div className="flex flex-col md:flex-row justify-between items-center mb-6">
                            <div>
                                <h3 className="text-lg font-bold text-white flex items-center gap-2">
                                    <Icon name="Server" size={20} className="text-green-400"/>
                                    传输模拟实验室
                                </h3>
                                <p className="text-xs text-slate-400 mt-1">模拟 30% 丢包率下的表现差异</p>
                            </div>
                            
                            <div className="flex gap-2 mt-4 md:mt-0 bg-slate-900 p-1 rounded-lg border border-slate-700">
                                <button 
                                    onClick={() => { setSimMode('TCP'); setPackets([]); setIsSimulating(false); }}
                                    className={`px-4 py-1.5 rounded text-xs font-bold transition-all ${simMode === 'TCP' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
                                >
                                    TCP 模式
                                </button>
                                <button 
                                    onClick={() => { setSimMode('UDP'); setPackets([]); setIsSimulating(false); }}
                                    className={`px-4 py-1.5 rounded text-xs font-bold transition-all ${simMode === 'UDP' ? 'bg-orange-600 text-white shadow-lg' : 'text-slate-400 hover:text-white'}`}
                                >
                                    UDP 模式
                                </button>
                            </div>
                        </div>

                        {/* Simulation Viewport */}
                        <div className="bg-slate-950 rounded-lg border border-slate-800 h-48 relative overflow-hidden flex items-center mb-4">
                            {/* Lanes */}
                            <div className="absolute inset-0 flex flex-col justify-center">
                                <div className="h-[1px] bg-slate-800 w-full mb-8"></div>
                                <div className="h-[1px] bg-slate-800 w-full mt-8"></div>
                            </div>

                            {/* Start/End Labels */}
                            <div className="absolute left-4 top-2 text-xs text-slate-500">Client (Sender)</div>
                            <div className="absolute right-4 top-2 text-xs text-slate-500">Server (Receiver)</div>

                            {/* Packets */}
                            <div className="w-full relative h-20 px-10">
                                {packets.map((pkt) => (
                                    <div 
                                        key={pkt.id}
                                        className={`absolute top-1/2 -translate-y-1/2 w-12 h-8 rounded border flex items-center justify-center text-[10px] font-bold shadow-lg transition-all duration-500
                                            ${pkt.status === 'sending' ? 'left-[10%] bg-slate-700 text-white animate-pulse' : ''}
                                            ${pkt.status === 'lost' ? 'left-[50%] opacity-0 scale-150 bg-red-500 border-red-500' : ''}
                                            ${pkt.status === 'success' ? 'left-[90%] bg-green-900 border-green-500 text-green-400' : ''}
                                            ${pkt.status === 'retransmitting' ? 'left-[40%] bg-yellow-900 border-yellow-500 text-yellow-400' : ''}
                                        `}
                                        style={{ transitionDuration: pkt.status === 'sending' ? '1s' : '0.5s' }}
                                    >
                                        #{pkt.id}
                                    </div>
                                ))}
                                
                                {/* Lost Packet Indicator */}
                                {packets.some(p => p.status === 'lost') && (
                                    <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-red-500 font-bold text-xs animate-ping">
                                        Packet Loss!
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Controls & Stats */}
                        <div className="flex justify-between items-center">
                            <button 
                                onClick={runSimulation}
                                disabled={isSimulating}
                                className={`px-6 py-2 rounded font-bold text-sm flex items-center gap-2 ${isSimulating ? 'bg-slate-700 text-slate-500 cursor-not-allowed' : 'bg-green-600 text-white hover:bg-green-500 shadow-lg hover:shadow-green-500/25'}`}
                            >
                                {isSimulating ? '传输中...' : '开始发送数据 (5个包)'}
                            </button>

                            <div className="flex gap-4 text-xs font-mono">
                                <div className="bg-slate-900 px-3 py-1 rounded border border-slate-700 text-slate-300">
                                    Sent: <span className="text-white font-bold">{stats.sent}</span>
                                </div>
                                <div className="bg-slate-900 px-3 py-1 rounded border border-slate-700 text-red-400">
                                    Lost: <span className="font-bold">{stats.lost}</span>
                                </div>
                                {simMode === 'TCP' && (
                                    <div className="bg-slate-900 px-3 py-1 rounded border border-slate-700 text-yellow-400">
                                        Retries: <span className="font-bold">{stats.retrans}</span>
                                    </div>
                                )}
                            </div>
                        </div>
                         
                         {/* Explanation Text */}
                         <div className="mt-4 bg-slate-900/50 p-3 rounded text-xs text-slate-400 border-l-2 border-slate-600">
                            {simMode === 'TCP' 
                                ? "TCP 观察：当出现丢包 (红色) 时，你会发现传输会有明显的停顿。这是因为 TCP 需要等待超时并重新发送数据，确保接收端按顺序收到所有数据。"
                                : "UDP 观察：当出现丢包 (红色) 时，后续的数据包不会停下等待。数据包直接“消失”了，虽然速度快，但接收端得到的文件可能是不完整的。"
                            }
                         </div>
                    </div>
                </div>
            );
        };

// --- PAGE 4: APPLICATION LAYER (ENHANCED PRACTICAL) ---
        const PageAppLayer = () => {
            return (
                <div className="space-y-12 fade-in pb-12">
                     <header className="mb-2 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-green-400">应用层实战：HTTP 与 现代 Web</h2>
                        <p className="text-slate-400 mt-2 text-base">前端与后端开发最常打交道的领域。不只是 GET/POST，更是 Token、JSON 与 WebSocket。</p>
                    </header>

                    {/* Section 1: The Stateless Problem (Cookies/Tokens) */}
                    <section>
                        <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <span className="bg-green-500 w-1 h-6 rounded"></span>
                            1. 身份维持 (State Management)
                        </h3>
                        <div className="glass-panel p-6 rounded-xl">
                            <p className="text-sm text-slate-300 mb-6">
                                HTTP 是<strong>无状态</strong>的。服务器不知道刚才发请求的人和现在发请求的人是不是同一个。
                                为了实现“登录”状态，我们需要在客户端（浏览器）存储票据。
                            </p>
                            
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                {/* Step 1 */}
                                <div className="bg-slate-800/50 border border-slate-700 p-4 rounded-lg relative">
                                    <div className="absolute -top-3 left-3 bg-slate-700 text-xs px-2 py-0.5 rounded text-white">Step 1: 登录</div>
                                    <div className="text-center mt-2 space-y-2">
                                        <div className="text-xs font-mono bg-slate-900 p-2 rounded text-blue-300 text-left">
                                            POST /login<br/>
                                            {`{ user: "admin", pass: "***" }`}
                                        </div>
                                        <div className="text-xl">⬇️</div>
                                        <div className="text-xs font-mono bg-slate-900 p-2 rounded text-green-300 text-left border border-green-500/30">
                                            HTTP 200 OK<br/>
                                            <span className="text-yellow-400 font-bold">Set-Cookie: token=xyz123;</span>
                                        </div>
                                        <p className="text-xs text-slate-400 mt-2">服务器在响应头中下发“通行证”。</p>
                                    </div>
                                </div>

                                {/* Step 2 */}
                                <div className="bg-slate-800/50 border border-slate-700 p-4 rounded-lg relative">
                                    <div className="absolute -top-3 left-3 bg-slate-700 text-xs px-2 py-0.5 rounded text-white">Step 2: 存储</div>
                                    <div className="flex flex-col items-center justify-center h-full">
                                        <div className="w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center border-2 border-yellow-500/50 mb-2">
                                            <span className="text-2xl">🍪</span>
                                        </div>
                                        <div className="text-xs font-bold text-slate-300">Browser Cookie Jar</div>
                                        <p className="text-xs text-slate-500 text-center mt-2">浏览器自动将 token 保存，下次访问同域名时会自动携带。</p>
                                    </div>
                                </div>

                                {/* Step 3 */}
                                <div className="bg-slate-800/50 border border-slate-700 p-4 rounded-lg relative">
                                    <div className="absolute -top-3 left-3 bg-slate-700 text-xs px-2 py-0.5 rounded text-white">Step 3: 访问</div>
                                    <div className="text-center mt-2 space-y-2">
                                        <div className="text-xs font-mono bg-slate-900 p-2 rounded text-blue-300 text-left border border-yellow-500/30">
                                            GET /profile<br/>
                                            <span className="text-yellow-400 font-bold">Cookie: token=xyz123</span>
                                        </div>
                                        <div className="text-xl">⬇️</div>
                                        <div className="text-xs font-mono bg-slate-900 p-2 rounded text-green-300 text-left">
                                            HTTP 200 OK<br/>
                                            {`{ name: "Admin", ... }`}
                                        </div>
                                        <p className="text-xs text-slate-400 mt-2">服务器看到 Cookie，认出你是 Admin。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Section 2: Data Format (JSON) */}
                    <section>
                         <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <span className="bg-purple-500 w-1 h-6 rounded"></span>
                            2. 实际的数据载体 (JSON)
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="space-y-4">
                                <p className="text-sm text-slate-300">
                                    现代 Web 开发（前后端分离）很少直接返回 HTML 页面，而是返回 <strong>JSON</strong> 数据。前端框架（React/Vue）拿到数据后渲染成界面。
                                </p>
                                <div className="bg-slate-800 p-4 rounded border border-slate-700">
                                    <div className="text-xs text-slate-500 mb-2 border-b border-slate-700 pb-1">Response Body Preview</div>
                                    <pre className="font-mono text-xs leading-relaxed">
<span className="text-yellow-500">{"{"}</span>
  <span className="text-blue-400">"code"</span>: <span className="text-green-400">200</span>,
  <span className="text-blue-400">"message"</span>: <span className="text-orange-300">"success"</span>,
  <span className="text-blue-400">"data"</span>: <span className="text-yellow-500">{"{"}</span>
    <span className="text-blue-400">"userId"</span>: <span className="text-green-400">89012</span>,
    <span className="text-blue-400">"username"</span>: <span className="text-orange-300">"net_master"</span>,
    <span className="text-blue-400">"tags"</span>: <span className="text-purple-400">[</span><span className="text-orange-300">"admin"</span>, <span className="text-orange-300">"vip"</span><span className="text-purple-400">]</span>
  <span className="text-yellow-500">{"}"}</span>
<span className="text-yellow-500">{"}"}</span>
                                    </pre>
                                </div>
                            </div>
                            <div className="flex flex-col justify-center gap-4">
                                <div className="bg-slate-800/50 p-4 rounded border border-slate-700">
                                    <div className="font-bold text-slate-200 text-sm mb-1">Content-Type: application/json</div>
                                    <p className="text-xs text-slate-400">这是 HTTP 头中最重要的字段之一，告诉浏览器：“别把它当网页解析，这是数据对象”。</p>
                                </div>
                                <div className="bg-slate-800/50 p-4 rounded border border-slate-700">
                                    <div className="font-bold text-slate-200 text-sm mb-1">RESTful API 设计</div>
                                    <p className="text-xs text-slate-400">
                                        利用 HTTP 方法表达动作：<br/>
                                        <span className="text-blue-400">GET</span> 获取用户 <br/>
                                        <span className="text-green-400">POST</span> 创建用户 <br/>
                                        <span className="text-orange-400">PUT</span> 修改用户 <br/>
                                        <span className="text-red-400">DELETE</span> 删除用户
                                    </p>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Section 3: Real-time (WebSocket) */}
                    <section>
                         <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <span className="bg-blue-500 w-1 h-6 rounded"></span>
                            3. 实时通信 (HTTP vs WebSocket)
                        </h3>
                        <div className="glass-panel p-5 rounded-xl grid grid-cols-1 md:grid-cols-2 gap-8">
                            
                            {/* HTTP Polling */}
                            <div>
                                <h4 className="font-bold text-slate-300 mb-2 text-sm text-center">传统 HTTP (轮询)</h4>
                                <div className="bg-slate-900/80 h-40 rounded border border-slate-700 relative overflow-hidden flex flex-col items-center justify-center gap-2">
                                    <div className="flex gap-2 text-[10px] text-slate-500 items-center animate-pulse">
                                        <span>Client</span> &rarr; <span>你有新消息吗？</span> &rarr; <span>Server</span>
                                    </div>
                                    <div className="flex gap-2 text-[10px] text-slate-500 items-center animate-pulse delay-75">
                                        <span>Client</span> &larr; <span>没有。</span> &larr; <span>Server</span>
                                    </div>
                                    <div className="w-full h-[1px] bg-slate-800 my-1"></div>
                                    <div className="flex gap-2 text-[10px] text-slate-500 items-center animate-pulse delay-150">
                                        <span>Client</span> &rarr; <span>现在有吗？</span> &rarr; <span>Server</span>
                                    </div>
                                </div>
                                <p className="text-xs text-slate-400 mt-2 text-center">
                                    <strong>短连接：</strong> 每次都要重新握手，效率低，像每隔几秒就打电话问快递到了没。
                                </p>
                            </div>

                            {/* WebSocket */}
                            <div>
                                <h4 className="font-bold text-blue-400 mb-2 text-sm text-center">WebSocket (双向长连接)</h4>
                                <div className="bg-slate-900/80 h-40 rounded border border-blue-900/50 relative overflow-hidden flex flex-col items-center justify-center">
                                    {/* The Pipe */}
                                    <div className="absolute top-1/2 left-4 right-4 h-8 border-y border-blue-500/30 bg-blue-500/5 flex items-center">
                                         <div className="w-2 h-2 rounded-full bg-green-400 absolute left-0 animate-flow-right shadow-[0_0_10px_green]"></div>
                                         <div className="w-2 h-2 rounded-full bg-blue-400 absolute right-0 animate-flow-left shadow-[0_0_10px_blue] delay-100"></div>
                                    </div>
                                    <div className="z-10 bg-slate-900 px-2 text-[10px] text-blue-300 border border-blue-900 rounded">
                                        Connection Established
                                    </div>
                                </div>
                                <p className="text-xs text-slate-400 mt-2 text-center">
                                    <strong>长连接：</strong> 建立一次通道后保持开启，服务器有数据直接推送到客户端。用于聊天、股票、游戏。
                                </p>
                            </div>

                        </div>
                    </section>
                </div>
            );
        };

        // --- PAGE 5: INFRASTRUCTURE (NAT ANIMATION) ---
        const PageInfra = () => {
            const [step, setStep] = useState(0); 
            const [isPlaying, setIsPlaying] = useState(false);
            const timerRef = useRef(null);

            // Animation Steps Configuration
            const steps = [
                { id: 0, text: "准备就绪：内网主机计划访问 Google (8.8.8.8)。" },
                { id: 1, text: "1. 发起请求：主机发送数据包，源地址是内网 IP (192.168.1.5)。" },
                { id: 2, text: "2. NAT 登记：路由器拦截数据包。为了区分是哪台内网设备发的，路由器在 NAT 表中记录映射关系，并分配一个临时端口号 (60001)。" },
                { id: 3, text: "3. 地址转换 (SNAT) 与转发：路由器将数据包的【源地址】修改为自己的【公网 IP】，然后发给 Google。" },
                { id: 4, text: "4. 服务器处理：Google 收到请求，看到的是路由器的公网 IP。它处理完请求，准备回包。" },
                { id: 5, text: "5. 服务器回包：Google 发送响应数据，目标地址是路由器的公网 IP (203.0.113.1:60001)。" },
                { id: 6, text: "6. NAT 查表：路由器收到回包，根据端口号 (60001) 查表，发现这是给 192.168.1.5 的快递。" },
                { id: 7, text: "7. 地址还原 (DNAT) 与交付：路由器将数据包的【目标地址】改回【内网 IP】，最终送达主机。" },
            ];

            const nextStep = () => {
                setStep(prev => (prev + 1) % steps.length);
            };

            const reset = () => {
                setStep(0);
                setIsPlaying(false);
                if(timerRef.current) clearInterval(timerRef.current);
            };

            const togglePlay = () => {
                if (isPlaying) {
                    setIsPlaying(false);
                    if(timerRef.current) clearInterval(timerRef.current);
                } else {
                    setIsPlaying(true);
                    timerRef.current = setInterval(() => {
                        setStep(prev => {
                            if (prev >= steps.length - 1) {
                                clearInterval(timerRef.current);
                                setIsPlaying(false);
                                return prev;
                            }
                            return prev + 1;
                        });
                    }, 2500); // 2.5s per step
                }
            };

            useEffect(() => {
                return () => { if(timerRef.current) clearInterval(timerRef.current); };
            }, []);

            // Helper to determine packet position and style
            const getPacketStyle = (s) => {
                const base = "absolute transition-all duration-1000 ease-in-out z-20 flex flex-col items-center justify-center w-24 h-16 text-[10px] font-mono rounded shadow-lg border";
                
                // Colors
                const reqColor = "bg-blue-900/90 border-blue-500 text-blue-100";
                const resColor = "bg-green-900/90 border-green-500 text-green-100";

                // Positions (approximate %)
                const posHost = { left: '10%', top: '50%' };
                const posRouterIn = { left: '40%', top: '50%' };
                const posRouterOut = { left: '60%', top: '50%' };
                const posGoogle = { left: '90%', top: '50%' };

                switch(s) {
                    case 0: return { ...posHost, opacity: 0, className: base };
                    case 1: return { ...posRouterIn, opacity: 1, className: `${base} ${reqColor}`, content: { src: '192.168.1.5', dst: '8.8.8.8' } };
                    case 2: return { ...posRouterIn, opacity: 1, className: `${base} ${reqColor} scale-110 ring-2 ring-yellow-400`, content: { src: '192.168.1.5', dst: '8.8.8.8' } }; // Record
                    case 3: return { ...posGoogle, opacity: 1, className: `${base} ${reqColor}`, content: { src: '203.0.113.1', dst: '8.8.8.8' } }; // Converted
                    case 4: return { ...posGoogle, opacity: 1, className: `${base} ${resColor} scale-110`, content: { src: '8.8.8.8', dst: '203.0.113.1' } }; // Processing
                    case 5: return { ...posRouterOut, opacity: 1, className: `${base} ${resColor}`, content: { src: '8.8.8.8', dst: '203.0.113.1' } }; // Return
                    case 6: return { ...posRouterOut, opacity: 1, className: `${base} ${resColor} scale-110 ring-2 ring-yellow-400`, content: { src: '8.8.8.8', dst: '203.0.113.1' } }; // Lookup
                    case 7: return { ...posHost, opacity: 1, className: `${base} ${resColor}`, content: { src: '8.8.8.8', dst: '192.168.1.5' } }; // Delivered
                    default: return { ...posHost, opacity: 0, className: base };
                }
            };

            const pkt = getPacketStyle(step);

            return (
                <div className="space-y-8 fade-in pb-12">
                    <header className="mb-6 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-pink-400">网络边界：NAT (网络地址转换)</h2>
                        <p className="text-slate-400 mt-2 text-base">
                            IPv4 地址只有约 43 亿个，早已不够用。NAT 技术允许整个局域网共用一个公网 IP 上网。
                        </p>
                    </header>

                    {/* Animation Container */}
                    <div className="glass-panel p-1 rounded-xl bg-slate-900/50 relative overflow-hidden">
                        
                        {/* Control Bar */}
                        <div className="absolute top-4 left-4 z-30 flex gap-2">
                            <button onClick={togglePlay} className="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs flex items-center gap-1">
                                {isPlaying ? <span>⏸ 暂停</span> : <span>▶ 播放动画</span>}
                            </button>
                            <button onClick={nextStep} className="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs">
                                下一步 &rarr;
                            </button>
                            <button onClick={reset} className="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs">
                                重置
                            </button>
                        </div>

                        {/* Status Text */}
                        <div className="absolute top-4 right-4 z-30 max-w-md text-right">
                             <div className="text-pink-400 font-bold text-sm mb-1">Step {step} / 7</div>
                             <div className="text-xs text-slate-300 bg-slate-900/80 p-2 rounded border border-slate-700">
                                {steps[step].text}
                             </div>
                        </div>

                        {/* Visual Stage */}
                        <div className="h-[400px] relative w-full mt-12">
                            
                            {/* 1. LAN AREA */}
                            <div className="absolute left-4 top-1/2 -translate-y-1/2 w-48 h-64 border-2 border-dashed border-slate-700 rounded-xl bg-slate-800/20 flex flex-col items-center justify-end pb-4">
                                <div className="absolute top-[-10px] left-4 bg-slate-800 text-slate-400 text-xs px-2">内网 (LAN)</div>
                                <div className="flex flex-col items-center">
                                    <Icon name="Home" size={32} className="text-blue-400 mb-2"/>
                                    <div className="text-xs font-bold text-slate-300">我的电脑</div>
                                    <div className="text-[10px] font-mono text-slate-500">IP: 192.168.1.5</div>
                                </div>
                            </div>

                            {/* 2. ROUTER / NAT AREA */}
                            <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center z-10">
                                {/* Router Icon */}
                                <div className="w-16 h-16 bg-slate-800 border-2 border-pink-500 rounded-lg flex items-center justify-center shadow-[0_0_20px_rgba(236,72,153,0.2)] mb-2 relative">
                                    <Icon name="Network" size={32} className="text-pink-400"/>
                                    <div className="absolute -bottom-8 text-[10px] font-mono text-pink-300 bg-slate-900 px-1 rounded border border-pink-900">
                                        Public: 203.0.113.1
                                    </div>
                                </div>
                                
                                {/* NAT Table */}
                                <div className="mt-8 bg-slate-900 border border-slate-700 rounded p-2 text-[10px] font-mono w-64 shadow-xl">
                                    <div className="text-center text-slate-500 border-b border-slate-800 mb-1 pb-1">NAT 映射表 (Mapping Table)</div>
                                    <div className="grid grid-cols-2 gap-2 text-slate-600 mb-1">
                                        <div>内网地址</div>
                                        <div>公网端口</div>
                                    </div>
                                    {/* Dynamic Row */}
                                    <div className={`grid grid-cols-2 gap-2 transition-all duration-500 ${step >= 2 && step <= 6 ? 'bg-pink-900/30 text-pink-300' : 'opacity-0'}`}>
                                        <div>192.168.1.5:1234</div>
                                        <div>:60001</div>
                                    </div>
                                    <div className="text-center text-slate-700 mt-1">...</div>
                                </div>
                            </div>

                            {/* 3. INTERNET AREA */}
                            <div className="absolute right-4 top-1/2 -translate-y-1/2 w-48 h-64 border-l border-slate-800 flex flex-col items-center justify-center">
                                <div className="absolute top-10 right-4 text-slate-600 text-xs">互联网 (Internet)</div>
                                <div className="flex flex-col items-center">
                                    <div className={`w-16 h-16 rounded-full flex items-center justify-center transition-colors duration-500 ${step === 4 ? 'bg-green-600 shadow-[0_0_20px_rgba(34,197,94,0.4)]' : 'bg-slate-700'}`}>
                                        <div className="text-2xl">G</div>
                                    </div>
                                    <div className="text-xs font-bold text-slate-300 mt-2">Google Server</div>
                                    <div className="text-[10px] font-mono text-slate-500">IP: 8.8.8.8</div>
                                </div>
                            </div>

                            {/* THE PACKET */}
                            <div 
                                className={pkt.className}
                                style={{ 
                                    left: pkt.left, 
                                    top: pkt.top, 
                                    opacity: pkt.opacity,
                                    transform: 'translate(-50%, -50%)' 
                                }}
                            >
                                {pkt.content && (
                                    <>
                                        <div className="flex justify-between w-full px-1 mb-1 border-b border-white/10">
                                            <span className="opacity-50">Src</span>
                                            <span className="font-bold">{pkt.content.src.includes('192') ? '...1.5' : pkt.content.src.includes('203') ? '...13.1' : 'Google'}</span>
                                        </div>
                                        <div className="flex justify-between w-full px-1">
                                            <span className="opacity-50">Dst</span>
                                            <span className="font-bold">{pkt.content.dst.includes('8.8') ? 'Google' : pkt.content.dst.includes('203') ? '...13.1' : '...1.5'}</span>
                                        </div>
                                    </>
                                )}
                            </div>

                            {/* Connecting Lines */}
                            <div className="absolute top-1/2 left-[20%] right-[20%] h-[1px] bg-slate-800 -z-10"></div>

                        </div>
                    </div>

                    <div className="glass-panel p-5 rounded-xl border-l-4 border-yellow-500">
                        <h4 className="font-bold text-yellow-400 mb-1 flex items-center gap-2 text-sm">
                            <Icon name="Truck" size={14}/> 核心逻辑总结
                        </h4>
                        <p className="text-sm text-slate-300">
                           NAT 就像一个公司前台。所有的员工（内网设备）寄快递（发请求）都由前台（路由器）统一发出，发件人写的都是前台的地址。当有回信时，前台根据记录，把信件分发给具体的员工。
                        </p>
                        <ul className="list-disc list-inside mt-2 text-xs text-slate-400 space-y-1">
                            <li><strong>SNAT (Source NAT):</strong> 出去时，改写源地址 (Source)。</li>
                            <li><strong>DNAT (Destination NAT):</strong> 回来时，改写目标地址 (Destination)。</li>
                        </ul>
                    </div>
                </div>
             );
        };

        // --- MAIN APP ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('intro');

            const navItems = [
                { id: 'intro', label: 'CS 架构', icon: 'Home' },
                { id: 'address', label: 'IP 与 寻址', icon: 'MapPin' },
                { id: 'transport', label: '传输层', icon: 'Truck' },
                { id: 'app', label: '应用层', icon: 'Layers' },
                { id: 'infra', label: '网络边界', icon: 'Network' },
            ];

            const renderContent = () => {
                switch(activeTab) {
                    case 'intro': return <PageIntro />;
                    case 'address': return <PageAddressing />;
                    case 'transport': return <PageTransport />;
                    case 'app': return <PageAppLayer />;
                    case 'infra': return <PageInfra />;
                    default: return <PageIntro />;
                }
            };

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 flex flex-col">
                    
                    {/* Top Navigation Bar */}
                    <nav className="sticky top-0 z-50 bg-slate-900/90 backdrop-blur border-b border-slate-800">
                        <div className="max-w-5xl mx-auto px-4 md:px-6 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2 font-bold text-lg tracking-tight text-white mr-8">
                                <div className="bg-blue-600 p-1.5 rounded-lg">
                                    <Icon name="Globe" className="text-white" size={18}/>
                                </div>
                                <span>NetWorld</span>
                            </div>

                            {/* Desktop/Scrollable Nav */}
                            <div className="flex-1 overflow-x-auto no-scrollbar">
                                <div className="flex items-center gap-1 md:gap-6 min-w-max">
                                    {navItems.map(item => (
                                        <button
                                            key={item.id}
                                            onClick={() => setActiveTab(item.id)}
                                            className={`flex items-center gap-2 px-3 py-4 text-sm font-medium transition-colors nav-item whitespace-nowrap
                                                ${activeTab === item.id ? 'active text-blue-400' : 'text-slate-400'}
                                            `}
                                        >
                                            <Icon name={item.icon} size={16} />
                                            {item.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content Area */}
                    <main className="flex-1 w-full max-w-4xl mx-auto px-4 py-8 md:py-12">
                        {renderContent()}
                    </main>

                    <footer className="py-8 text-center text-xs text-slate-600 border-t border-slate-900 mt-auto">
                        <p>计算机网络基础教学演示</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>