<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NetWorld - è®¡ç®—æœºç½‘ç»œåŸºç¡€</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { font-family: 'Segoe UI', 'PingFang SC', system-ui, sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        
        /* é¡¶éƒ¨å¯¼èˆªæ¿€æ´»æ ·å¼ */
        .nav-item.active { color: #60a5fa; border-bottom: 2px solid #60a5fa; }
        .nav-item { transition: all 0.2s ease; border-bottom: 2px solid transparent; }
        .nav-item:hover:not(.active) { color: #93c5fd; }

        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes flowRight { 0% { left: 0; opacity: 1; } 100% { left: 100%; opacity: 0; } }
        @keyframes flowLeft { 0% { left: 100%; opacity: 1; } 100% { left: 0; opacity: 0; } }
        
        .animate-flow-right { animation: flowRight 1.5s linear infinite; }
        .animate-flow-left { animation: flowLeft 1.5s linear infinite; }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ä»£ç å—æ ·å¼ */
        .code-block { font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; line-height: 1.5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS WRAPPER ---
        const Icon = ({ name, size = 18, className }) => {
            const icons = {
                Home: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
                MapPin: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
                Truck: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="16" height="13" x="1" y="5" rx="2" /><polygon points="19 18 19 9 17 9 17 5 13 5 13 9 13 18" /><circle cx="5.5" cy="18.5" r="2.5" /><circle cx="13.5" cy="18.5" r="2.5" /></svg>,
                Layers: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
                Network: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="16" y="16" width="6" height="6" rx="1"/><rect x="2" y="16" width="6" height="6" rx="1"/><rect x="9" y="2" width="6" height="6" rx="1"/><path d="M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3"/><path d="M12 12V8"/></svg>,
                Search: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>,
                Server: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>,
                Globe: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><path d="M2 12h20"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
                Lock: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
                Database: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
                FileText: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>,
                User: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            };
            return icons[name] || null;
        };

        // --- PAGE 1: ADVANCED CS MODEL ---
        const PageIntro = () => {
            const [scenario, setScenario] = useState('static'); // static, login
            const [status, setStatus] = useState('idle'); // idle, sending, processing, db_query, db_return, responding, rendering
            const [logs, setLogs] = useState([]);

            const scenarios = {
                static: {
                    label: "æµè§ˆæ–‡ç«  (GET)",
                    icon: "FileText",
                    req: "GET /index.html HTTP/1.1\nHost: www.example.com",
                    res: "HTTP/1.1 200 OK\nContent-Type: text/html\n\n<html>...</html>",
                    hasDB: false
                },
                login: {
                    label: "ç”¨æˆ·ç™»å½• (POST)",
                    icon: "User",
                    req: "POST /api/login HTTP/1.1\nContent-Type: application/json\n\n{\"u\":\"user\", \"p\":\"***\"}",
                    res: "HTTP/1.1 200 OK\nSet-Cookie: session_id=xyz\n\n{\"status\":\"success\"}",
                    hasDB: true
                }
            };

            const runSimulation = () => {
                if(status !== 'idle') return;
                
                setLogs([]);
                const currentScenario = scenarios[scenario];

                // Step 1: Client Sending
                setStatus('sending');
                addLog('Client', 'æ„å»ºè¯·æ±‚æŠ¥æ–‡', currentScenario.req);

                // Step 2: Server Processing
                setTimeout(() => {
                    setStatus('processing');
                    addLog('Server', 'æ¥æ”¶å¹¶è§£æè¯·æ±‚', 'æ­£åœ¨åˆ†æè¯·æ±‚è·¯å¾„ä¸æ–¹æ³•...');
                    
                    // Step 3: DB (Optional)
                    if (currentScenario.hasDB) {
                        setTimeout(() => {
                            setStatus('db_query');
                            addLog('Server', 'æŸ¥è¯¢æ•°æ®åº“', 'SELECT * FROM users WHERE...');
                            
                            setTimeout(() => {
                                setStatus('db_return');
                                addLog('Database', 'è¿”å›æŸ¥è¯¢ç»“æœ', 'User found. ID: 1001');
                                
                                setTimeout(() => {
                                    setStatus('responding');
                                    addLog('Server', 'ç”Ÿæˆå“åº”æŠ¥æ–‡', currentScenario.res);
                                }, 1000);
                            }, 1500);
                        }, 1500);
                    } else {
                        // Static file directly
                        setTimeout(() => {
                            addLog('Server', 'è¯»å–é™æ€æ–‡ä»¶', 'Reading /var/www/index.html...');
                            setStatus('responding');
                            addLog('Server', 'ç”Ÿæˆå“åº”æŠ¥æ–‡', currentScenario.res);
                        }, 1500);
                    }

                }, 2000);
            };

            // Watch for responding state to finish simulation
            useEffect(() => {
                if (status === 'responding') {
                    setTimeout(() => {
                        setStatus('rendering');
                        addLog('Client', 'æ¥æ”¶å“åº”å¹¶æ¸²æŸ“', 'è§£æ HTML/JSON å¹¶æ›´æ–°ç•Œé¢');
                        setTimeout(() => setStatus('idle'), 2000);
                    }, 2000);
                }
            }, [status]);

            const addLog = (source, action, detail) => {
                setLogs(prev => [...prev, { source, action, detail, time: new Date().toLocaleTimeString() }]);
            };

            const currentScen = scenarios[scenario];

            return (
                <div className="space-y-6 fade-in pb-12">
                    <header className="mb-4 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-blue-400">åŸºç¡€æ¶æ„ï¼šC/S æ¨¡å‹æ·±åº¦è§£æ</h2>
                        <p className="text-slate-400 mt-2 text-base">
                            ä¸åªæ˜¯ç®€å•çš„â€œè¯·æ±‚-å“åº”â€ã€‚åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°æ•°æ®åŒ…æ˜¯å¦‚ä½•è¢«æ„å»ºã€ä¼ è¾“ã€åœ¨æœåŠ¡å™¨å†…éƒ¨æµè½¬ï¼ˆWebæœåŠ¡ vs æ•°æ®åº“ï¼‰ï¼Œæœ€ç»ˆè¢«æµè§ˆå™¨æ¸²æŸ“çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚
                        </p>
                    </header>

                    {/* Scenario Selector */}
                    <div className="flex gap-4 mb-6">
                        {Object.entries(scenarios).map(([key, data]) => (
                            <button
                                key={key}
                                onClick={() => { setScenario(key); setStatus('idle'); setLogs([]); }}
                                disabled={status !== 'idle'}
                                className={`flex items-center gap-2 px-4 py-3 rounded-lg border transition-all ${
                                    scenario === key 
                                    ? 'bg-blue-600/20 border-blue-500 text-blue-300' 
                                    : 'bg-slate-800 border-slate-700 text-slate-400 hover:border-slate-600'
                                } ${status !== 'idle' ? 'opacity-50 cursor-not-allowed' : ''}`}
                            >
                                <Icon name={data.icon} />
                                <div className="text-left">
                                    <div className="font-bold text-sm">{data.label}</div>
                                    <div className="text-[10px] opacity-70">{key === 'static' ? 'æ— éœ€æŸ¥åº“' : 'æ¶‰åŠæ•°æ®åº“äº¤äº’'}</div>
                                </div>
                            </button>
                        ))}
                    </div>

                    {/* MAIN STAGE */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        
                        {/* Left: Visual Animation */}
                        <div className="lg:col-span-2 glass-panel p-1 rounded-xl bg-slate-900/50 relative overflow-hidden min-h-[400px]">
                            
                            {/* 1. Client Zone */}
                            <div className="absolute top-1/2 left-8 -translate-y-1/2 w-28 flex flex-col items-center z-10">
                                <div className={`w-24 h-20 bg-slate-800 border-2 rounded-lg flex flex-col overflow-hidden transition-all duration-500 ${status === 'rendering' ? 'border-green-400 shadow-[0_0_20px_rgba(74,222,128,0.3)]' : 'border-slate-600'}`}>
                                    {/* Simulated Browser UI */}
                                    <div className="h-4 bg-slate-700 w-full flex items-center px-1 gap-1">
                                        <div className="w-1.5 h-1.5 rounded-full bg-red-500"></div>
                                        <div className="w-1.5 h-1.5 rounded-full bg-yellow-500"></div>
                                        <div className="h-2 bg-slate-900 rounded w-16 ml-1"></div>
                                    </div>
                                    <div className="flex-1 bg-white p-1 relative">
                                        {status === 'idle' && <div className="text-[8px] text-slate-400 text-center mt-4">Ready</div>}
                                        {(status === 'sending' || status === 'processing' || status.includes('db')) && (
                                            <div className="absolute inset-0 flex items-center justify-center">
                                                <div className="w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                                            </div>
                                        )}
                                        {status === 'rendering' && (
                                            <div className="animate-pulse space-y-1">
                                                <div className="h-2 bg-slate-200 rounded w-3/4"></div>
                                                <div className="h-2 bg-slate-200 rounded w-full"></div>
                                                <div className="h-2 bg-slate-200 rounded w-1/2"></div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                <div className="mt-2 text-center">
                                    <div className="font-bold text-sm text-slate-300">Client (Browser)</div>
                                    <button 
                                        onClick={runSimulation} 
                                        disabled={status !== 'idle'}
                                        className={`mt-2 px-3 py-1 rounded text-xs font-bold transition-all ${status === 'idle' ? 'bg-blue-600 text-white hover:bg-blue-500 shadow-lg hover:shadow-blue-500/50' : 'bg-slate-700 text-slate-500'}`}
                                    >
                                        {status === 'idle' ? 'å‘èµ·è¯·æ±‚' : 'å¤„ç†ä¸­...'}
                                    </button>
                                </div>
                            </div>

                            {/* 2. Server Zone */}
                            <div className="absolute top-1/2 right-8 -translate-y-1/2 w-48 h-64 border border-slate-700 rounded-xl bg-slate-800/30 p-2 flex flex-col justify-between z-10">
                                <div className="absolute -top-3 left-4 bg-slate-800 text-[10px] text-slate-400 px-2">Data Center</div>
                                
                                {/* Web Server App */}
                                <div className={`h-24 bg-slate-800 border-2 rounded-lg flex flex-col items-center justify-center relative transition-all duration-300 ${['processing', 'responding'].includes(status) ? 'border-indigo-400 shadow-[0_0_15px_rgba(129,140,248,0.3)]' : 'border-indigo-900/50'}`}>
                                    <Icon name="Server" className="text-indigo-400 mb-1" />
                                    <div className="text-xs font-bold text-indigo-300">Web Server</div>
                                    <div className="text-[9px] text-slate-500">Nginx / Node.js</div>
                                    {['processing', 'responding'].includes(status) && <div className="absolute top-1 right-1 w-2 h-2 bg-green-400 rounded-full animate-ping"></div>}
                                </div>

                                {/* Internal Connection */}
                                <div className="flex-1 flex justify-center py-1">
                                    <div className={`w-1 transition-colors duration-300 ${['db_query', 'db_return'].includes(status) ? 'bg-yellow-500 animate-pulse' : 'bg-slate-700'}`}></div>
                                </div>

                                {/* Database */}
                                <div className={`h-20 bg-slate-800 border-2 rounded-lg flex flex-col items-center justify-center relative transition-all duration-300 ${['db_query', 'db_return'].includes(status) ? 'border-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.3)]' : 'border-slate-700 opacity-60'}`}>
                                    <Icon name="Database" className={['db_query', 'db_return'].includes(status) ? "text-yellow-400" : "text-slate-600"} />
                                    <div className="text-xs font-bold text-slate-300 mt-1">Database</div>
                                    {['db_query', 'db_return'].includes(status) && <div className="text-[8px] text-yellow-500 absolute bottom-1 animate-pulse">Querying...</div>}
                                </div>
                            </div>

                            {/* 3. The Pipes & Packets */}
                            {/* Request Path */}
                            <div className="absolute top-[35%] left-32 right-52 h-[2px] bg-slate-800">
                                {status === 'sending' && (
                                    <div className="absolute top-1/2 -translate-y-1/2 animate-flow-right z-20">
                                        <div className="bg-blue-600 text-white text-[10px] font-mono px-2 py-1 rounded shadow-lg border border-blue-400 whitespace-nowrap">
                                            {currentScen.req.split('\n')[0]}
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Response Path */}
                            <div className="absolute top-[45%] left-32 right-52 h-[2px] bg-slate-800">
                                {status === 'responding' && (
                                    <div className="absolute top-1/2 -translate-y-1/2 animate-flow-left z-20">
                                        <div className="bg-green-600 text-white text-[10px] font-mono px-2 py-1 rounded shadow-lg border border-green-400 whitespace-nowrap">
                                            HTTP 200 OK
                                        </div>
                                    </div>
                                )}
                            </div>

                        </div>

                        {/* Right: Network Log Console */}
                        <div className="glass-panel rounded-xl flex flex-col h-[400px] overflow-hidden border-slate-700">
                            <div className="bg-slate-800 p-3 border-b border-slate-700 flex justify-between items-center">
                                <div className="font-mono text-xs text-slate-300 flex items-center gap-2">
                                    <div className="w-2 h-2 rounded-full bg-red-500"></div> Network Inspector
                                </div>
                                <div className="text-[10px] text-slate-500">Live Traffic</div>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-950 font-mono text-xs custom-scroll">
                                {logs.length === 0 && (
                                    <div className="text-slate-600 text-center mt-10 italic">Waiting for request...</div>
                                )}
                                {logs.map((log, i) => (
                                    <div key={i} className="animate-fade-in">
                                        <div className="flex items-center gap-2 mb-1">
                                            <span className="text-slate-500">[{log.time}]</span>
                                            <span className={`font-bold px-1.5 py-0.5 rounded text-[10px] ${
                                                log.source === 'Client' ? 'bg-blue-900 text-blue-300' :
                                                log.source === 'Server' ? 'bg-indigo-900 text-indigo-300' :
                                                'bg-yellow-900 text-yellow-300'
                                            }`}>{log.source}</span>
                                            <span className="text-slate-300">{log.action}</span>
                                        </div>
                                        {log.detail && (
                                            <div className="ml-4 pl-2 border-l-2 border-slate-800 text-slate-500 whitespace-pre-wrap break-all bg-slate-900/50 p-2 rounded">
                                                {log.detail}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>

                    </div>
                    
                    {/* Deep Dive Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
                         <div className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 hover:border-blue-500/30 transition-colors">
                            <h4 className="font-bold text-blue-400 mb-2 text-sm">æ„å»º (Build)</h4>
                            <p className="text-xs text-slate-400 leading-relaxed">
                                å®¢æˆ·ç«¯å°†ä½ çš„ç‚¹å‡»è¡Œä¸ºè½¬åŒ–ä¸ºç¬¦åˆ HTTP åè®®çš„å­—ç¬¦ä¸²ã€‚åŒ…æ‹¬è¯·æ±‚è¡Œï¼ˆMethod Pathï¼‰ã€è¯·æ±‚å¤´ï¼ˆHeadersï¼‰å’Œè¯·æ±‚ä½“ï¼ˆBodyï¼‰ã€‚
                            </p>
                        </div>
                        <div className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 hover:border-indigo-500/30 transition-colors">
                            <h4 className="font-bold text-indigo-400 mb-2 text-sm">å¤„ç† (Process)</h4>
                            <p className="text-xs text-slate-400 leading-relaxed">
                                Web æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼Œå¦‚æœæ˜¯é™æ€èµ„æºï¼ˆå›¾ç‰‡/HTMLï¼‰ç›´æ¥è¯»å–æ–‡ä»¶ï¼›å¦‚æœæ˜¯åŠ¨æ€è¯·æ±‚ï¼ˆç™»å½•ï¼‰ï¼Œåˆ™éœ€è¦æ‰§è¡Œä»£ç å¹¶æŸ¥è¯¢æ•°æ®åº“ã€‚
                            </p>
                        </div>
                        <div className="bg-slate-800/50 p-4 rounded-lg border border-slate-700 hover:border-green-500/30 transition-colors">
                            <h4 className="font-bold text-green-400 mb-2 text-sm">æ¸²æŸ“ (Render)</h4>
                            <p className="text-xs text-slate-400 leading-relaxed">
                                æµè§ˆå™¨æ‹¿åˆ° HTML ä»£ç å¹¶ä¸æ˜¯ç»“æŸã€‚å®ƒéœ€è¦è§£æ DOM æ ‘ï¼ŒåŠ è½½ CSS æ ·å¼ï¼Œæ‰§è¡Œ JS è„šæœ¬ï¼Œæœ€ç»ˆåƒç´ çº§ç»˜åˆ¶åœ¨å±å¹•ä¸Šã€‚
                            </p>
                        </div>
                    </div>

                </div>
            );
        };

        // --- PAGE 2: ADDRESSING ---
        const PageAddressing = () => {
             const [step, setStep] = useState(0); 
             const [domain, setDomain] = useState('bilibili.com');
             const [resolveResult, setResolveResult] = useState({ ip: '', type: '' });

             const resolveDns = async () => {
                 if(!domain) return;
                 setStep(1);
                 setResolveResult({ ip: '', type: '' });
                 
                 try {
                     // 1. å¹¶è¡Œæ‰§è¡Œï¼šAPIè¯·æ±‚ + æœ€å°åŠ¨ç”»å»¶æ—¶(1.5ç§’)ï¼Œé˜²æ­¢åŠ¨ç”»å¤ªå¿«çœ‹ä¸æ¸…
                     const fetchPromise = fetch(`https://dns.google/resolve?name=${domain}`).then(res => res.json());
                     const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
                     
                     const [data] = await Promise.all([fetchPromise, delayPromise]);

                     if (data.Answer && data.Answer.length > 0) {
                         // ä¼˜å…ˆæ‰¾ A è®°å½• (IPv4)ï¼Œæ‰¾ä¸åˆ°å°±æ‹¿ç¬¬ä¸€ä¸ª
                         const record = data.Answer.find(r => r.type === 1) || data.Answer[0];
                         // å¦‚æœæ˜¯ CNAME (type 5)ï¼Œæ˜¾ç¤º dataï¼Œå¦‚æœæ˜¯ A (type 1)ï¼Œæ˜¾ç¤º IP
                         setResolveResult({ 
                             ip: record.data, 
                             type: record.type === 5 ? 'CNAME' : 'A Record' 
                         });
                     } else {
                         setResolveResult({ ip: 'æœªæ‰¾åˆ°è®°å½•', type: 'NXDOMAIN' });
                     }
                 } catch (error) {
                     setResolveResult({ ip: 'æŸ¥è¯¢å¤±è´¥ (è¯·æ£€æŸ¥ç½‘ç»œ)', type: 'Error' });
                 } finally {
                     setStep(2);
                 }
             };

             return (
                <div className="space-y-8 fade-in pb-12">
                    <header className="mb-6 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-purple-400">ç½‘ç»œå±‚ä¸å¯»å€ï¼šIP ä¸ ç«¯å£</h2>
                        <p className="text-slate-400 mt-2 text-base">ç½‘ç»œé€šä¿¡çš„ä¸¤ä¸ªæ ¸å¿ƒè¦ç´ ï¼šå®šä½ä¸»æœº (IP) ä¸å®šä½è¿›ç¨‹ (Port)ã€‚</p>
                    </header>

                    {/* DNS Logic Flow */}
                    <div className="glass-panel p-6 rounded-xl">
                        <h3 className="text-base font-bold mb-4 flex items-center gap-2 text-slate-200">
                            <Icon name="Search" /> 
                            DNS å®æ—¶è§£ææ¼”ç¤º (Powered by Google DNS)
                        </h3>
                        <div className="flex flex-col md:flex-row items-center gap-4 bg-slate-900/50 p-6 rounded-xl border border-slate-700">
                            
                            {/* Input Area */}
                            <div className={`transition-all duration-500 flex-1`}>
                                <div className="text-xs text-slate-500 mb-1 font-mono">Input Domain</div>
                                <div className="flex gap-2">
                                    <input 
                                        type="text" 
                                        value={domain}
                                        onChange={(e) => setDomain(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && resolveDns()}
                                        className="bg-slate-800 px-3 py-1.5 rounded text-white font-mono border border-slate-600 text-sm outline-none focus:border-purple-500 w-full md:w-48"
                                        placeholder="è¾“å…¥åŸŸå..."
                                    />
                                    <button 
                                        onClick={resolveDns} 
                                        disabled={step === 1 || !domain} 
                                        className="bg-purple-600 hover:bg-purple-500 px-4 rounded text-xs disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap transition-colors"
                                    >
                                        {step === 1 ? 'æŸ¥è¯¢ä¸­...' : 'è§£æ IP'}
                                    </button>
                                </div>
                            </div>

                            <div className="text-slate-600 hidden md:block">&rarr;</div>

                            {/* DNS Server Animation */}
                            <div className={`transition-all duration-500 flex flex-col items-center w-24 ${step >= 1 ? 'opacity-100' : 'opacity-30'}`}>
                                <Icon name="Server" className="text-yellow-500 mb-1" />
                                <div className="text-[10px] text-yellow-500 font-bold uppercase">DNS Server</div>
                                {step === 1 && <div className="text-[10px] text-slate-400 animate-pulse mt-1">Recursive Query...</div>}
                            </div>

                            <div className="text-slate-600 hidden md:block">&rarr;</div>

                            {/* Result Area */}
                            <div className={`transition-all duration-500 flex-1 ${step === 2 ? 'opacity-100' : 'opacity-0'}`}>
                                <div className="text-xs text-slate-500 mb-1 font-mono">Resolved IP</div>
                                <div className="flex flex-col items-start">
                                    <div className={`px-3 py-1.5 rounded font-mono text-sm border shadow-lg ${
                                        resolveResult.type === 'Error' ? 'bg-red-900/30 text-red-400 border-red-900/50' : 
                                        'bg-slate-800 text-green-400 border-green-900/50 shadow-[0_0_15px_rgba(74,222,128,0.1)]'
                                    }`}>
                                        {resolveResult.ip}
                                    </div>
                                    {resolveResult.type && (
                                        <span className="text-[10px] text-slate-500 mt-1 ml-1 bg-slate-900 px-1 rounded border border-slate-800">
                                            Type: {resolveResult.type}
                                        </span>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        {/* IP Section */}
                        <div className="space-y-4">
                            <h3 className="text-lg font-bold text-white border-l-4 border-blue-500 pl-3">IP åœ°å€ (IPv4)</h3>
                            <p className="text-slate-400 text-sm">
                                ç½‘ç»œå±‚åè®®ï¼Œç”¨äºåœ¨åˆ†ç»„äº¤æ¢ç½‘ç»œä¸­å”¯ä¸€æ ‡è¯†ä¸€å°ä¸»æœºã€‚
                            </p>
                            <div className="bg-slate-800 p-4 rounded-lg font-mono text-center text-base tracking-wider border border-slate-600">
                                <span className="text-blue-400">192</span>.<span className="text-blue-400">168</span>.<span className="text-blue-400">1</span>.<span className="text-white font-bold">5</span>
                            </div>
                            <div className="text-xs text-slate-500 mt-2">
                                * IPv4 æ ¼å¼ï¼š32ä½äºŒè¿›åˆ¶æ•°ï¼Œé€šå¸¸è¡¨ç¤ºä¸º4ä¸ªåè¿›åˆ¶æ•° (ç‚¹åˆ†åè¿›åˆ¶)ã€‚
                            </div>
                        </div>

                        {/* Port Section */}
                        <div className="space-y-4">
                            <h3 className="text-lg font-bold text-white border-l-4 border-purple-500 pl-3">ç«¯å£å· (Port Number)</h3>
                            <p className="text-slate-400 text-sm">
                                ä¼ è¾“å±‚æ¦‚å¿µï¼Œç”¨äºæ ‡è¯†ä¸»æœºä¸­ç‰¹å®šçš„åº”ç”¨ç¨‹åºæˆ–è¿›ç¨‹ (å¤šè·¯å¤ç”¨)ã€‚
                            </p>
                            
                            <div className="grid grid-cols-2 gap-2 text-sm">
                                <div className="bg-slate-800 p-2 rounded border border-slate-700 flex justify-between">
                                    <span className="font-mono text-purple-300">:80</span>
                                    <span className="text-xs text-slate-400">HTTP (Web)</span>
                                </div>
                                <div className="bg-slate-800 p-2 rounded border border-slate-700 flex justify-between">
                                    <span className="font-mono text-purple-300">:443</span>
                                    <span className="text-xs text-slate-400">HTTPS (Secure)</span>
                                </div>
                                <div className="bg-slate-800 p-2 rounded border border-slate-700 flex justify-between">
                                    <span className="font-mono text-purple-300">:22</span>
                                    <span className="text-xs text-slate-400">SSH (Remote)</span>
                                </div>
                                <div className="bg-slate-800 p-2 rounded border border-slate-700 flex justify-between">
                                    <span className="font-mono text-purple-300">:3306</span>
                                    <span className="text-xs text-slate-400">MySQL (DB)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
             );
        };

        // --- PAGE 3: TRANSPORT LAYER ---
        const PageTransport = () => {
            const [handshakeStep, setHandshakeStep] = useState(0);

            useEffect(() => {
                if(handshakeStep > 0 && handshakeStep < 4) {
                    const timer = setTimeout(() => setHandshakeStep(p => p + 1), 1500);
                    return () => clearTimeout(timer);
                }
            }, [handshakeStep]);

            return (
                <div className="space-y-8 fade-in pb-12">
                    <header className="mb-6 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-orange-400">ä¼ è¾“å±‚åè®®ï¼šTCP ä¸ UDP</h2>
                        <p className="text-slate-400 mt-2 text-base">å®šä¹‰æ•°æ®åœ¨ç½‘ç»œä¸­çš„ä¼ è¾“æ–¹å¼ã€å¯é æ€§åŠé¡ºåºæ§åˆ¶ã€‚</p>
                    </header>

                    {/* Comparison Cards */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="bg-slate-800/80 p-5 rounded-lg border border-blue-500/30">
                            <h3 className="text-lg font-bold text-blue-400 mb-3">TCP (Transmission Control Protocol)</h3>
                            <ul className="space-y-2 text-sm text-slate-300">
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-500 font-mono">TYPE:</span>
                                    <span><strong>é¢å‘è¿æ¥ï¼š</strong> å¿…é¡»å…ˆå»ºç«‹è¿æ¥ (ä¸‰æ¬¡æ¡æ‰‹)ã€‚</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-500 font-mono">RELY:</span>
                                    <span><strong>å¯é ä¼ è¾“ï¼š</strong> åŒ…å«ç¡®è®¤æœºåˆ¶ (ACK) å’Œé‡ä¼ æœºåˆ¶ã€‚</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-blue-500 font-mono">ORD :</span>
                                    <span><strong>æœ‰åºæ€§ï¼š</strong> ä¿è¯æ•°æ®åŒ…æŒ‰å‘é€é¡ºåºåˆ°è¾¾ã€‚</span>
                                </li>
                                <li className="mt-3 pt-2 border-t border-slate-700 text-xs text-slate-500">åº”ç”¨åœºæ™¯ï¼šWeb æµè§ˆ (HTTP), é‚®ä»¶ (SMTP), æ–‡ä»¶ä¼ è¾“ (FTP)</li>
                            </ul>
                        </div>

                        <div className="bg-slate-800/80 p-5 rounded-lg border border-orange-500/30">
                            <h3 className="text-lg font-bold text-orange-400 mb-3">UDP (User Datagram Protocol)</h3>
                            <ul className="space-y-2 text-sm text-slate-300">
                                <li className="flex items-start gap-2">
                                    <span className="text-orange-500 font-mono">TYPE:</span>
                                    <span><strong>æ— è¿æ¥ï¼š</strong> æ— éœ€å»ºç«‹è¿æ¥ï¼Œç›´æ¥å‘é€æ•°æ®æŠ¥ã€‚</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-orange-500 font-mono">RELY:</span>
                                    <span><strong>ä¸å¯é ï¼š</strong> ä¸ä¿è¯åˆ°è¾¾ï¼Œä¸é‡ä¼ ä¸¢å¼ƒçš„åŒ…ã€‚</span>
                                </li>
                                <li className="flex items-start gap-2">
                                    <span className="text-orange-500 font-mono">SPD :</span>
                                    <span><strong>ä½å»¶è¿Ÿï¼š</strong> å¤´éƒ¨å¼€é”€å°ï¼Œä¼ è¾“é€Ÿåº¦å¿«ã€‚</span>
                                </li>
                                <li className="mt-3 pt-2 border-t border-slate-700 text-xs text-slate-500">åº”ç”¨åœºæ™¯ï¼šå®æ—¶è§†é¢‘æµ, åœ¨çº¿æ¸¸æˆ, DNS æŸ¥è¯¢</li>
                            </ul>
                        </div>
                    </div>

                    {/* 3-Way Handshake Animation */}
                    <div className="glass-panel p-6 rounded-xl">
                        <h3 className="text-base font-bold mb-6 text-center text-slate-200">TCP ä¸‰æ¬¡æ¡æ‰‹ (Three-Way Handshake)</h3>
                        <div className="relative flex justify-between px-12 md:px-32 h-48">
                            {/* Vertical Lines */}
                            <div className="w-[1px] h-full bg-slate-700 absolute left-12 md:left-32"></div>
                            <div className="w-[1px] h-full bg-slate-700 absolute right-12 md:right-32"></div>

                            {/* Labels */}
                            <div className="absolute -top-6 left-8 md:left-28 font-mono text-sm text-slate-400">Client</div>
                            <div className="absolute -top-6 right-6 md:right-28 font-mono text-sm text-slate-400">Server</div>

                            {/* Step 1: SYN */}
                            <div className={`absolute top-4 left-14 md:left-36 right-14 md:right-36 transition-opacity duration-500 ${handshakeStep >= 1 ? 'opacity-100' : 'opacity-10'}`}>
                                <div className="h-[1px] bg-blue-500 w-full transform rotate-3 origin-left relative">
                                    <div className="absolute -top-5 left-1/3 text-[10px] text-blue-400 bg-slate-900 px-1 font-mono">SYN = 1</div>
                                    <div className="absolute right-0 -top-[3px] w-1.5 h-1.5 bg-blue-500 rounded-full"></div>
                                </div>
                            </div>

                            {/* Step 2: SYN-ACK */}
                            <div className={`absolute top-20 left-14 md:left-36 right-14 md:right-36 transition-opacity duration-500 delay-200 ${handshakeStep >= 2 ? 'opacity-100' : 'opacity-10'}`}>
                                <div className="h-[1px] bg-green-500 w-full transform -rotate-3 origin-right relative">
                                    <div className="absolute -top-5 left-1/3 text-[10px] text-green-400 bg-slate-900 px-1 font-mono">SYN=1, ACK=1</div>
                                    <div className="absolute left-0 -top-[3px] w-1.5 h-1.5 bg-green-500 rounded-full"></div>
                                </div>
                            </div>

                             {/* Step 3: ACK */}
                             <div className={`absolute top-36 left-14 md:left-36 right-14 md:right-36 transition-opacity duration-500 delay-400 ${handshakeStep >= 3 ? 'opacity-100' : 'opacity-10'}`}>
                                <div className="h-[1px] bg-blue-500 w-full transform rotate-3 origin-left relative">
                                    <div className="absolute -top-5 left-1/3 text-[10px] text-blue-400 bg-slate-900 px-1 font-mono">ACK = 1</div>
                                    <div className="absolute right-0 -top-[3px] w-1.5 h-1.5 bg-blue-500 rounded-full"></div>
                                </div>
                            </div>

                            {/* Control */}
                            <div className="absolute bottom-0 left-0 w-full flex justify-center translate-y-8">
                                <button 
                                    onClick={() => setHandshakeStep(prev => prev === 4 ? 0 : 1)}
                                    className="bg-slate-800 hover:bg-slate-700 border border-slate-600 px-4 py-1.5 rounded text-xs transition-colors text-slate-300"
                                >
                                    {handshakeStep === 0 ? 'Start Handshake' : handshakeStep === 4 ? 'Reset' : 'Connecting...'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- PAGE 4: APPLICATION LAYER ---
        const PageAppLayer = () => {
            return (
                <div className="space-y-8 fade-in pb-12">
                     <header className="mb-6 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-green-400">åº”ç”¨å±‚ï¼šHTTP åè®®</h2>
                        <p className="text-slate-400 mt-2 text-base">è¶…æ–‡æœ¬ä¼ è¾“åè®® (HyperText Transfer Protocol) åŠå…¶å®‰å…¨æ‰©å±•ã€‚</p>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        {/* HTTP Methods */}
                        <div className="lg:col-span-2 glass-panel p-5 rounded-lg">
                            <h3 className="text-base font-bold mb-4 flex items-center gap-2 text-white">
                                <Icon name="Layers" size={16} /> è¯·æ±‚æ–¹æ³• (Request Methods)
                            </h3>
                            <div className="space-y-3">
                                <div className="flex items-start gap-3 p-3 rounded bg-slate-800/50 border border-slate-700">
                                    <div className="bg-blue-600/20 text-blue-400 font-mono font-bold px-2 py-0.5 rounded text-xs w-14 text-center mt-0.5 border border-blue-600/30">GET</div>
                                    <div>
                                        <div className="text-sm font-bold text-slate-200">è¯·æ±‚èµ„æº</div>
                                        <div className="text-xs text-slate-400 mt-1">è¯·æ±‚æŒ‡å®šçš„é¡µé¢ä¿¡æ¯ï¼Œå‚æ•°åŒ…å«åœ¨ URL ä¸­ã€‚å¹‚ç­‰æ“ä½œã€‚</div>
                                    </div>
                                </div>
                                <div className="flex items-start gap-3 p-3 rounded bg-slate-800/50 border border-slate-700">
                                    <div className="bg-green-600/20 text-green-400 font-mono font-bold px-2 py-0.5 rounded text-xs w-14 text-center mt-0.5 border border-green-600/30">POST</div>
                                    <div>
                                        <div className="text-sm font-bold text-slate-200">æäº¤æ•°æ®</div>
                                        <div className="text-xs text-slate-400 mt-1">å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆå¦‚æäº¤è¡¨å•ï¼‰ã€‚æ•°æ®åŒ…å«åœ¨ Request Body ä¸­ã€‚</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Status Codes */}
                        <div className="glass-panel p-5 rounded-lg">
                            <h3 className="text-base font-bold mb-4 text-white">çŠ¶æ€ç  (Status Codes)</h3>
                            <div className="space-y-3">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-6 flex items-center justify-center bg-green-500/10 text-green-400 font-mono text-xs font-bold rounded border border-green-500/30">200</div>
                                    <div className="text-xs text-slate-300">OK - è¯·æ±‚æˆåŠŸ</div>
                                </div>
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-6 flex items-center justify-center bg-yellow-500/10 text-yellow-400 font-mono text-xs font-bold rounded border border-yellow-500/30">404</div>
                                    <div className="text-xs text-slate-300">Not Found - èµ„æºä¸å­˜åœ¨</div>
                                </div>
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-6 flex items-center justify-center bg-red-500/10 text-red-400 font-mono text-xs font-bold rounded border border-red-500/30">500</div>
                                    <div className="text-xs text-slate-300">Server Error - å†…éƒ¨é”™è¯¯</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* HTTP vs HTTPS Visual */}
                    <div className="glass-panel p-6 rounded-xl">
                         <h3 className="text-base font-bold mb-6 text-center text-slate-200">HTTP vs HTTPS (å®‰å…¨æ€§å¯¹æ¯”)</h3>
                         <div className="flex flex-col md:flex-row justify-center items-center gap-8 md:gap-20">
                             
                             <div className="text-center opacity-80">
                                 <div className="w-16 h-20 bg-slate-800 border border-slate-600 rounded flex flex-col items-center justify-center mx-auto mb-2 relative">
                                    <div className="text-[9px] text-slate-500 absolute top-2 font-mono">HTTP</div>
                                     <div className="text-xl">ğŸ“„</div>
                                 </div>
                                 <div className="text-sm font-bold text-slate-300">æ˜æ–‡ä¼ è¾“</div>
                                 <div className="text-xs text-slate-500 mt-1">æ•°æ®æ— åŠ å¯†ï¼Œ<br/>æ˜“è¢«çªƒå¬ç¯¡æ”¹</div>
                             </div>

                             <div className="flex flex-col items-center">
                                 <div className="text-xs text-slate-500 mb-1">SSL/TLS å±‚</div>
                                 <div className="h-[1px] w-20 bg-slate-600"></div>
                             </div>

                             <div className="text-center">
                                 <div className="w-16 h-20 bg-slate-800 border border-green-500/50 rounded flex flex-col items-center justify-center mx-auto mb-2 relative shadow-[0_0_10px_rgba(34,197,94,0.1)]">
                                     <div className="absolute top-[-8px] bg-slate-900 rounded-full p-1 border border-green-500/50">
                                         <Icon name="Lock" size={10} className="text-green-400"/>
                                     </div>
                                     <div className="text-[9px] text-green-500 absolute top-2 font-mono">HTTPS</div>
                                     <div className="text-xl opacity-50">ğŸ“„</div>
                                 </div>
                                 <div className="text-sm font-bold text-green-400">åŠ å¯†ä¼ è¾“</div>
                                 <div className="text-xs text-slate-500 mt-1">ä¿è¯æœºå¯†æ€§<br/>ä¸å®Œæ•´æ€§</div>
                             </div>

                         </div>
                    </div>
                </div>
            );
        };

        // --- PAGE 5: INFRASTRUCTURE (NAT ANIMATION) ---
        const PageInfra = () => {
            const [step, setStep] = useState(0); 
            const [isPlaying, setIsPlaying] = useState(false);
            const timerRef = useRef(null);

            // Animation Steps Configuration
            const steps = [
                { id: 0, text: "å‡†å¤‡å°±ç»ªï¼šå†…ç½‘ä¸»æœºè®¡åˆ’è®¿é—® Google (8.8.8.8)ã€‚" },
                { id: 1, text: "1. å‘èµ·è¯·æ±‚ï¼šä¸»æœºå‘é€æ•°æ®åŒ…ï¼Œæºåœ°å€æ˜¯å†…ç½‘ IP (192.168.1.5)ã€‚" },
                { id: 2, text: "2. NAT ç™»è®°ï¼šè·¯ç”±å™¨æ‹¦æˆªæ•°æ®åŒ…ã€‚ä¸ºäº†åŒºåˆ†æ˜¯å“ªå°å†…ç½‘è®¾å¤‡å‘çš„ï¼Œè·¯ç”±å™¨åœ¨ NAT è¡¨ä¸­è®°å½•æ˜ å°„å…³ç³»ï¼Œå¹¶åˆ†é…ä¸€ä¸ªä¸´æ—¶ç«¯å£å· (60001)ã€‚" },
                { id: 3, text: "3. åœ°å€è½¬æ¢ (SNAT) ä¸è½¬å‘ï¼šè·¯ç”±å™¨å°†æ•°æ®åŒ…çš„ã€æºåœ°å€ã€‘ä¿®æ”¹ä¸ºè‡ªå·±çš„ã€å…¬ç½‘ IPã€‘ï¼Œç„¶åå‘ç»™ Googleã€‚" },
                { id: 4, text: "4. æœåŠ¡å™¨å¤„ç†ï¼šGoogle æ”¶åˆ°è¯·æ±‚ï¼Œçœ‹åˆ°çš„æ˜¯è·¯ç”±å™¨çš„å…¬ç½‘ IPã€‚å®ƒå¤„ç†å®Œè¯·æ±‚ï¼Œå‡†å¤‡å›åŒ…ã€‚" },
                { id: 5, text: "5. æœåŠ¡å™¨å›åŒ…ï¼šGoogle å‘é€å“åº”æ•°æ®ï¼Œç›®æ ‡åœ°å€æ˜¯è·¯ç”±å™¨çš„å…¬ç½‘ IP (203.0.113.1:60001)ã€‚" },
                { id: 6, text: "6. NAT æŸ¥è¡¨ï¼šè·¯ç”±å™¨æ”¶åˆ°å›åŒ…ï¼Œæ ¹æ®ç«¯å£å· (60001) æŸ¥è¡¨ï¼Œå‘ç°è¿™æ˜¯ç»™ 192.168.1.5 çš„å¿«é€’ã€‚" },
                { id: 7, text: "7. åœ°å€è¿˜åŸ (DNAT) ä¸äº¤ä»˜ï¼šè·¯ç”±å™¨å°†æ•°æ®åŒ…çš„ã€ç›®æ ‡åœ°å€ã€‘æ”¹å›ã€å†…ç½‘ IPã€‘ï¼Œæœ€ç»ˆé€è¾¾ä¸»æœºã€‚" },
            ];

            const nextStep = () => {
                setStep(prev => (prev + 1) % steps.length);
            };

            const reset = () => {
                setStep(0);
                setIsPlaying(false);
                if(timerRef.current) clearInterval(timerRef.current);
            };

            const togglePlay = () => {
                if (isPlaying) {
                    setIsPlaying(false);
                    if(timerRef.current) clearInterval(timerRef.current);
                } else {
                    setIsPlaying(true);
                    timerRef.current = setInterval(() => {
                        setStep(prev => {
                            if (prev >= steps.length - 1) {
                                clearInterval(timerRef.current);
                                setIsPlaying(false);
                                return prev;
                            }
                            return prev + 1;
                        });
                    }, 2500); // 2.5s per step
                }
            };

            useEffect(() => {
                return () => { if(timerRef.current) clearInterval(timerRef.current); };
            }, []);

            // Helper to determine packet position and style
            const getPacketStyle = (s) => {
                const base = "absolute transition-all duration-1000 ease-in-out z-20 flex flex-col items-center justify-center w-24 h-16 text-[10px] font-mono rounded shadow-lg border";
                
                // Colors
                const reqColor = "bg-blue-900/90 border-blue-500 text-blue-100";
                const resColor = "bg-green-900/90 border-green-500 text-green-100";

                // Positions (approximate %)
                const posHost = { left: '10%', top: '50%' };
                const posRouterIn = { left: '40%', top: '50%' };
                const posRouterOut = { left: '60%', top: '50%' };
                const posGoogle = { left: '90%', top: '50%' };

                switch(s) {
                    case 0: return { ...posHost, opacity: 0, className: base };
                    case 1: return { ...posRouterIn, opacity: 1, className: `${base} ${reqColor}`, content: { src: '192.168.1.5', dst: '8.8.8.8' } };
                    case 2: return { ...posRouterIn, opacity: 1, className: `${base} ${reqColor} scale-110 ring-2 ring-yellow-400`, content: { src: '192.168.1.5', dst: '8.8.8.8' } }; // Record
                    case 3: return { ...posGoogle, opacity: 1, className: `${base} ${reqColor}`, content: { src: '203.0.113.1', dst: '8.8.8.8' } }; // Converted
                    case 4: return { ...posGoogle, opacity: 1, className: `${base} ${resColor} scale-110`, content: { src: '8.8.8.8', dst: '203.0.113.1' } }; // Processing
                    case 5: return { ...posRouterOut, opacity: 1, className: `${base} ${resColor}`, content: { src: '8.8.8.8', dst: '203.0.113.1' } }; // Return
                    case 6: return { ...posRouterOut, opacity: 1, className: `${base} ${resColor} scale-110 ring-2 ring-yellow-400`, content: { src: '8.8.8.8', dst: '203.0.113.1' } }; // Lookup
                    case 7: return { ...posHost, opacity: 1, className: `${base} ${resColor}`, content: { src: '8.8.8.8', dst: '192.168.1.5' } }; // Delivered
                    default: return { ...posHost, opacity: 0, className: base };
                }
            };

            const pkt = getPacketStyle(step);

            return (
                <div className="space-y-8 fade-in pb-12">
                    <header className="mb-6 border-b border-slate-800 pb-4">
                        <h2 className="text-2xl font-bold text-pink-400">ç½‘ç»œè¾¹ç•Œï¼šNAT (ç½‘ç»œåœ°å€è½¬æ¢)</h2>
                        <p className="text-slate-400 mt-2 text-base">
                            IPv4 åœ°å€åªæœ‰çº¦ 43 äº¿ä¸ªï¼Œæ—©å·²ä¸å¤Ÿç”¨ã€‚NAT æŠ€æœ¯å…è®¸æ•´ä¸ªå±€åŸŸç½‘å…±ç”¨ä¸€ä¸ªå…¬ç½‘ IP ä¸Šç½‘ã€‚
                        </p>
                    </header>

                    {/* Animation Container */}
                    <div className="glass-panel p-1 rounded-xl bg-slate-900/50 relative overflow-hidden">
                        
                        {/* Control Bar */}
                        <div className="absolute top-4 left-4 z-30 flex gap-2">
                            <button onClick={togglePlay} className="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs flex items-center gap-1">
                                {isPlaying ? <span>â¸ æš‚åœ</span> : <span>â–¶ æ’­æ”¾åŠ¨ç”»</span>}
                            </button>
                            <button onClick={nextStep} className="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs">
                                ä¸‹ä¸€æ­¥ &rarr;
                            </button>
                            <button onClick={reset} className="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs">
                                é‡ç½®
                            </button>
                        </div>

                        {/* Status Text */}
                        <div className="absolute top-4 right-4 z-30 max-w-md text-right">
                             <div className="text-pink-400 font-bold text-sm mb-1">Step {step} / 7</div>
                             <div className="text-xs text-slate-300 bg-slate-900/80 p-2 rounded border border-slate-700">
                                {steps[step].text}
                             </div>
                        </div>

                        {/* Visual Stage */}
                        <div className="h-[400px] relative w-full mt-12">
                            
                            {/* 1. LAN AREA */}
                            <div className="absolute left-4 top-1/2 -translate-y-1/2 w-48 h-64 border-2 border-dashed border-slate-700 rounded-xl bg-slate-800/20 flex flex-col items-center justify-end pb-4">
                                <div className="absolute top-[-10px] left-4 bg-slate-800 text-slate-400 text-xs px-2">å†…ç½‘ (LAN)</div>
                                <div className="flex flex-col items-center">
                                    <Icon name="Home" size={32} className="text-blue-400 mb-2"/>
                                    <div className="text-xs font-bold text-slate-300">æˆ‘çš„ç”µè„‘</div>
                                    <div className="text-[10px] font-mono text-slate-500">IP: 192.168.1.5</div>
                                </div>
                            </div>

                            {/* 2. ROUTER / NAT AREA */}
                            <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center z-10">
                                {/* Router Icon */}
                                <div className="w-16 h-16 bg-slate-800 border-2 border-pink-500 rounded-lg flex items-center justify-center shadow-[0_0_20px_rgba(236,72,153,0.2)] mb-2 relative">
                                    <Icon name="Network" size={32} className="text-pink-400"/>
                                    <div className="absolute -bottom-8 text-[10px] font-mono text-pink-300 bg-slate-900 px-1 rounded border border-pink-900">
                                        Public: 203.0.113.1
                                    </div>
                                </div>
                                
                                {/* NAT Table */}
                                <div className="mt-8 bg-slate-900 border border-slate-700 rounded p-2 text-[10px] font-mono w-64 shadow-xl">
                                    <div className="text-center text-slate-500 border-b border-slate-800 mb-1 pb-1">NAT æ˜ å°„è¡¨ (Mapping Table)</div>
                                    <div className="grid grid-cols-2 gap-2 text-slate-600 mb-1">
                                        <div>å†…ç½‘åœ°å€</div>
                                        <div>å…¬ç½‘ç«¯å£</div>
                                    </div>
                                    {/* Dynamic Row */}
                                    <div className={`grid grid-cols-2 gap-2 transition-all duration-500 ${step >= 2 && step <= 6 ? 'bg-pink-900/30 text-pink-300' : 'opacity-0'}`}>
                                        <div>192.168.1.5:1234</div>
                                        <div>:60001</div>
                                    </div>
                                    <div className="text-center text-slate-700 mt-1">...</div>
                                </div>
                            </div>

                            {/* 3. INTERNET AREA */}
                            <div className="absolute right-4 top-1/2 -translate-y-1/2 w-48 h-64 border-l border-slate-800 flex flex-col items-center justify-center">
                                <div className="absolute top-10 right-4 text-slate-600 text-xs">äº’è”ç½‘ (Internet)</div>
                                <div className="flex flex-col items-center">
                                    <div className={`w-16 h-16 rounded-full flex items-center justify-center transition-colors duration-500 ${step === 4 ? 'bg-green-600 shadow-[0_0_20px_rgba(34,197,94,0.4)]' : 'bg-slate-700'}`}>
                                        <div className="text-2xl">G</div>
                                    </div>
                                    <div className="text-xs font-bold text-slate-300 mt-2">Google Server</div>
                                    <div className="text-[10px] font-mono text-slate-500">IP: 8.8.8.8</div>
                                </div>
                            </div>

                            {/* THE PACKET */}
                            <div 
                                className={pkt.className}
                                style={{ 
                                    left: pkt.left, 
                                    top: pkt.top, 
                                    opacity: pkt.opacity,
                                    transform: 'translate(-50%, -50%)' 
                                }}
                            >
                                {pkt.content && (
                                    <>
                                        <div className="flex justify-between w-full px-1 mb-1 border-b border-white/10">
                                            <span className="opacity-50">Src</span>
                                            <span className="font-bold">{pkt.content.src.includes('192') ? '...1.5' : pkt.content.src.includes('203') ? '...13.1' : 'Google'}</span>
                                        </div>
                                        <div className="flex justify-between w-full px-1">
                                            <span className="opacity-50">Dst</span>
                                            <span className="font-bold">{pkt.content.dst.includes('8.8') ? 'Google' : pkt.content.dst.includes('203') ? '...13.1' : '...1.5'}</span>
                                        </div>
                                    </>
                                )}
                            </div>

                            {/* Connecting Lines */}
                            <div className="absolute top-1/2 left-[20%] right-[20%] h-[1px] bg-slate-800 -z-10"></div>

                        </div>
                    </div>

                    <div className="glass-panel p-5 rounded-xl border-l-4 border-yellow-500">
                        <h4 className="font-bold text-yellow-400 mb-1 flex items-center gap-2 text-sm">
                            <Icon name="Truck" size={14}/> æ ¸å¿ƒé€»è¾‘æ€»ç»“
                        </h4>
                        <p className="text-sm text-slate-300">
                           NAT å°±åƒä¸€ä¸ªå…¬å¸å‰å°ã€‚æ‰€æœ‰çš„å‘˜å·¥ï¼ˆå†…ç½‘è®¾å¤‡ï¼‰å¯„å¿«é€’ï¼ˆå‘è¯·æ±‚ï¼‰éƒ½ç”±å‰å°ï¼ˆè·¯ç”±å™¨ï¼‰ç»Ÿä¸€å‘å‡ºï¼Œå‘ä»¶äººå†™çš„éƒ½æ˜¯å‰å°çš„åœ°å€ã€‚å½“æœ‰å›ä¿¡æ—¶ï¼Œå‰å°æ ¹æ®è®°å½•ï¼ŒæŠŠä¿¡ä»¶åˆ†å‘ç»™å…·ä½“çš„å‘˜å·¥ã€‚
                        </p>
                        <ul className="list-disc list-inside mt-2 text-xs text-slate-400 space-y-1">
                            <li><strong>SNAT (Source NAT):</strong> å‡ºå»æ—¶ï¼Œæ”¹å†™æºåœ°å€ (Source)ã€‚</li>
                            <li><strong>DNAT (Destination NAT):</strong> å›æ¥æ—¶ï¼Œæ”¹å†™ç›®æ ‡åœ°å€ (Destination)ã€‚</li>
                        </ul>
                    </div>
                </div>
             );
        };

        // --- MAIN APP ---
        const App = () => {
            const [activeTab, setActiveTab] = useState('intro');

            const navItems = [
                { id: 'intro', label: 'CS æ¶æ„', icon: 'Home' },
                { id: 'address', label: 'IP ä¸ å¯»å€', icon: 'MapPin' },
                { id: 'transport', label: 'ä¼ è¾“å±‚', icon: 'Truck' },
                { id: 'app', label: 'åº”ç”¨å±‚', icon: 'Layers' },
                { id: 'infra', label: 'ç½‘ç»œè¾¹ç•Œ', icon: 'Network' },
            ];

            const renderContent = () => {
                switch(activeTab) {
                    case 'intro': return <PageIntro />;
                    case 'address': return <PageAddressing />;
                    case 'transport': return <PageTransport />;
                    case 'app': return <PageAppLayer />;
                    case 'infra': return <PageInfra />;
                    default: return <PageIntro />;
                }
            };

            return (
                <div className="min-h-screen bg-slate-950 text-slate-200 flex flex-col">
                    
                    {/* Top Navigation Bar */}
                    <nav className="sticky top-0 z-50 bg-slate-900/90 backdrop-blur border-b border-slate-800">
                        <div className="max-w-5xl mx-auto px-4 md:px-6 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2 font-bold text-lg tracking-tight text-white mr-8">
                                <div className="bg-blue-600 p-1.5 rounded-lg">
                                    <Icon name="Globe" className="text-white" size={18}/>
                                </div>
                                <span>NetWorld</span>
                            </div>

                            {/* Desktop/Scrollable Nav */}
                            <div className="flex-1 overflow-x-auto no-scrollbar">
                                <div className="flex items-center gap-1 md:gap-6 min-w-max">
                                    {navItems.map(item => (
                                        <button
                                            key={item.id}
                                            onClick={() => setActiveTab(item.id)}
                                            className={`flex items-center gap-2 px-3 py-4 text-sm font-medium transition-colors nav-item whitespace-nowrap
                                                ${activeTab === item.id ? 'active text-blue-400' : 'text-slate-400'}
                                            `}
                                        >
                                            <Icon name={item.icon} size={16} />
                                            {item.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content Area */}
                    <main className="flex-1 w-full max-w-4xl mx-auto px-4 py-8 md:py-12">
                        {renderContent()}
                    </main>

                    <footer className="py-8 text-center text-xs text-slate-600 border-t border-slate-900 mt-auto">
                        <p>è®¡ç®—æœºç½‘ç»œåŸºç¡€æ•™å­¦æ¼”ç¤º</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>